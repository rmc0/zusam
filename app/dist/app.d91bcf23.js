parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"aSor":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.render=L,exports.hydrate=M,exports.h=exports.createElement=a,exports.Fragment=v,exports.createRef=h,exports.Component=y,exports.cloneElement=F,exports.createContext=R,exports.toChildArray=C,exports._unmount=W,exports.options=exports.isValidElement=void 0;var e,t,n,o,l,r,_,i,u={},s=[],c=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord/i;function p(e,t){for(var n in t)e[n]=t[n];return e}function f(e){var t=e.parentNode;t&&t.removeChild(e)}function a(e,t,n){var o,l=arguments,r={};for(o in t)"key"!==o&&"ref"!==o&&(r[o]=t[o]);if(arguments.length>3)for(n=[n],o=3;o<arguments.length;o++)n.push(l[o]);if(null!=n&&(r.children=n),"function"==typeof e&&null!=e.defaultProps)for(o in e.defaultProps)void 0===r[o]&&(r[o]=e.defaultProps[o]);return d(e,r,t&&t.key,t&&t.ref)}function d(t,n,o,l){var r={type:t,props:n,key:o,ref:l,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,constructor:void 0};return e.vnode&&e.vnode(r),r}function h(){return{}}function v(e){return e.children}function y(e,t){this.props=e,this.context=t}function m(e,t){if(null==t)return e.__?m(e.__,e.__.__k.indexOf(e)+1):null;for(var n;t<e.__k.length;t++)if(null!=(n=e.__k[t])&&null!=n.__e)return n.__e;return"function"==typeof e.type?m(e):null}function g(e){var t,n;if(null!=(e=e.__)&&null!=e.__c){for(e.__e=e.__c.base=null,t=0;t<e.__k.length;t++)if(null!=(n=e.__k[t])&&null!=n.__e){e.__e=e.__c.base=n.__e;break}return g(e)}}function k(t){(!t.__d&&(t.__d=!0)&&n.push(t)&&!o++||r!==e.debounceRendering)&&((r=e.debounceRendering)||l)(x)}function x(){for(var e;o=n.length;)e=n.sort(function(e,t){return e.__v.__b-t.__v.__b}),n=[],e.some(function(e){var t,n,o,l,r,_;e.__d&&(r=(l=(t=e).__v).__e,(_=t.__P)&&(n=[],o=N(_,l,p({},l),t.__n,void 0!==_.ownerSVGElement,null,n,null==r?m(l):r),U(n,l),o!=r&&g(l)))})}function b(e,t,n,o,l,r,_,i,c){var p,a,d,h,v,y,g,k=n&&n.__k||s,x=k.length;if(i==u&&(i=null!=r?r[0]:x?m(n,0):null),p=0,t.__k=C(t.__k,function(n){if(null!=n){if(n.__=t,n.__b=t.__b+1,null===(d=k[p])||d&&n.key==d.key&&n.type===d.type)k[p]=void 0;else for(a=0;a<x;a++){if((d=k[a])&&n.key==d.key&&n.type===d.type){k[a]=void 0;break}d=null}if(h=N(e,n,d=d||u,o,l,r,_,i,c),(a=n.ref)&&d.ref!=a&&(g||(g=[]),d.ref&&g.push(d.ref,null,n),g.push(a,n.__c||h,n)),null!=h){var s;if(null==y&&(y=h),void 0!==n.__d)s=n.__d,n.__d=void 0;else if(r==d||h!=i||null==h.parentNode){e:if(null==i||i.parentNode!==e)e.appendChild(h),s=null;else{for(v=i,a=0;(v=v.nextSibling)&&a<x;a+=2)if(v==h)break e;e.insertBefore(h,i),s=i}"option"==t.type&&(e.value="")}i=void 0!==s?s:h.nextSibling,"function"==typeof t.type&&(t.__d=i)}else i&&d.__e==i&&i.parentNode!=e&&(i=m(d))}return p++,n}),t.__e=y,null!=r&&"function"!=typeof t.type)for(p=r.length;p--;)null!=r[p]&&f(r[p]);for(p=x;p--;)null!=k[p]&&W(k[p],k[p]);if(g)for(p=0;p<g.length;p++)T(g[p],g[++p],g[++p])}function C(e,t,n){if(null==n&&(n=[]),null==e||"boolean"==typeof e)t&&n.push(t(null));else if(Array.isArray(e))for(var o=0;o<e.length;o++)C(e[o],t,n);else n.push(t?t("string"==typeof e||"number"==typeof e?d(null,e,null,null):null!=e.__e||null!=e.__c?d(e.type,e.props,e.key,null):e):e);return n}function w(e,t,n,o,l){var r;for(r in n)r in t||P(e,r,null,n[r],o);for(r in t)l&&"function"!=typeof t[r]||"value"===r||"checked"===r||n[r]===t[r]||P(e,r,t[r],n[r],o)}function S(e,t,n){"-"===t[0]?e.setProperty(t,n):e[t]="number"==typeof n&&!1===c.test(t)?n+"px":null==n?"":n}function P(e,t,n,o,l){var r,_,i,u,s;if(l?"className"===t&&(t="class"):"class"===t&&(t="className"),"key"===t||"children"===t);else if("style"===t)if(r=e.style,"string"==typeof n)r.cssText=n;else{if("string"==typeof o&&(r.cssText="",o=null),o)for(_ in o)n&&_ in n||S(r,_,"");if(n)for(i in n)o&&n[i]===o[i]||S(r,i,n[i])}else"o"===t[0]&&"n"===t[1]?(u=t!==(t=t.replace(/Capture$/,"")),s=t.toLowerCase(),t=(s in e?s:t).slice(2),n?(o||e.addEventListener(t,E,u),(e.l||(e.l={}))[t]=n):e.removeEventListener(t,E,u)):"list"!==t&&"tagName"!==t&&"form"!==t&&"type"!==t&&"size"!==t&&!l&&t in e?e[t]=null==n?"":n:"function"!=typeof n&&"dangerouslySetInnerHTML"!==t&&(t!==(t=t.replace(/^xlink:?/,""))?null==n||!1===n?e.removeAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase()):e.setAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase(),n):null==n||!1===n&&!/^ar/.test(t)?e.removeAttribute(t):e.setAttribute(t,n))}function E(t){this.l[t.type](e.event?e.event(t):t)}function N(t,n,o,l,r,_,i,u,s){var c,f,a,d,h,m,g,k,x,C,w=n.type;if(void 0!==n.constructor)return null;(c=e.__b)&&c(n);try{e:if("function"==typeof w){if(k=n.props,x=(c=w.contextType)&&l[c.__c],C=c?x?x.props.value:c.__:l,o.__c?g=(f=n.__c=o.__c).__=f.__E:("prototype"in w&&w.prototype.render?n.__c=f=new w(k,C):(n.__c=f=new y(k,C),f.constructor=w,f.render=A),x&&x.sub(f),f.props=k,f.state||(f.state={}),f.context=C,f.__n=l,a=f.__d=!0,f.__h=[]),null==f.__s&&(f.__s=f.state),null!=w.getDerivedStateFromProps&&(f.__s==f.state&&(f.__s=p({},f.__s)),p(f.__s,w.getDerivedStateFromProps(k,f.__s))),d=f.props,h=f.state,a)null==w.getDerivedStateFromProps&&null!=f.componentWillMount&&f.componentWillMount(),null!=f.componentDidMount&&f.__h.push(f.componentDidMount);else{if(null==w.getDerivedStateFromProps&&k!==d&&null!=f.componentWillReceiveProps&&f.componentWillReceiveProps(k,C),!f.__e&&null!=f.shouldComponentUpdate&&!1===f.shouldComponentUpdate(k,f.__s,C)){for(f.props=k,f.state=f.__s,f.__d=!1,f.__v=n,n.__e=o.__e,n.__k=o.__k,f.__h.length&&i.push(f),c=0;c<n.__k.length;c++)n.__k[c]&&(n.__k[c].__=n);break e}null!=f.componentWillUpdate&&f.componentWillUpdate(k,f.__s,C),null!=f.componentDidUpdate&&f.__h.push(function(){f.componentDidUpdate(d,h,m)})}f.context=C,f.props=k,f.state=f.__s,(c=e.__r)&&c(n),f.__d=!1,f.__v=n,f.__P=t,c=f.render(f.props,f.state,f.context),n.__k=null!=c&&c.type==v&&null==c.key?c.props.children:Array.isArray(c)?c:[c],null!=f.getChildContext&&(l=p(p({},l),f.getChildContext())),a||null==f.getSnapshotBeforeUpdate||(m=f.getSnapshotBeforeUpdate(d,h)),b(t,n,o,l,r,_,i,u,s),f.base=n.__e,f.__h.length&&i.push(f),g&&(f.__E=f.__=null),f.__e=!1}else n.__e=D(o.__e,n,o,l,r,_,i,s);(c=e.diffed)&&c(n)}catch(t){e.__e(t,n,o)}return n.__e}function U(t,n){e.__c&&e.__c(n,t),t.some(function(n){try{t=n.__h,n.__h=[],t.some(function(e){e.call(n)})}catch(t){e.__e(t,n.__v)}})}function D(e,t,n,o,l,r,_,i){var c,p,f,a,d,h=n.props,v=t.props;if(l="svg"===t.type||l,null!=r)for(c=0;c<r.length;c++)if(null!=(p=r[c])&&((null===t.type?3===p.nodeType:p.localName===t.type)||e==p)){e=p,r[c]=null;break}if(null==e){if(null===t.type)return document.createTextNode(v);e=l?document.createElementNS("http://www.w3.org/2000/svg",t.type):document.createElement(t.type,v.is&&{is:v.is}),r=null}if(null===t.type)h!==v&&e.data!=v&&(e.data=v);else if(t!==n){if(null!=r&&(r=s.slice.call(e.childNodes)),f=(h=n.props||u).dangerouslySetInnerHTML,a=v.dangerouslySetInnerHTML,!i){if(h===u)for(h={},d=0;d<e.attributes.length;d++)h[e.attributes[d].name]=e.attributes[d].value;(a||f)&&(a&&f&&a.__html==f.__html||(e.innerHTML=a&&a.__html||""))}w(e,v,h,l,i),t.__k=t.props.children,a||b(e,t,n,o,"foreignObject"!==t.type&&l,r,_,u,i),i||("value"in v&&void 0!==v.value&&v.value!==e.value&&(e.value=null==v.value?"":v.value),"checked"in v&&void 0!==v.checked&&v.checked!==e.checked&&(e.checked=v.checked))}return e}function T(t,n,o){try{"function"==typeof t?t(n):t.current=n}catch(t){e.__e(t,o)}}function W(t,n,o){var l,r,_;if(e.unmount&&e.unmount(t),(l=t.ref)&&(l.current&&l.current!==t.__e||T(l,null,n)),o||"function"==typeof t.type||(o=null!=(r=t.__e)),t.__e=t.__d=void 0,null!=(l=t.__c)){if(l.componentWillUnmount)try{l.componentWillUnmount()}catch(t){e.__e(t,n)}l.base=l.__P=null}if(l=t.__k)for(_=0;_<l.length;_++)l[_]&&W(l[_],n,o);null!=r&&f(r)}function A(e,t,n){return this.constructor(e,n)}function L(t,n,o){var l,r,i;e.__&&e.__(t,n),r=(l=o===_)?null:o&&o.__k||n.__k,t=a(v,null,[t]),i=[],N(n,(l?n:o||n).__k=t,r||u,u,void 0!==n.ownerSVGElement,o&&!l?[o]:r?null:s.slice.call(n.childNodes),i,o||u,l),U(i,t)}function M(e,t){L(e,t,_)}function F(e,t){return t=p(p({},e.props),t),arguments.length>2&&(t.children=s.slice.call(arguments,2)),d(e.type,t,t.key||e.key,t.ref||e.ref)}function R(e){var t={},n={__c:"__cC"+i++,__:e,Consumer:function(e,t){return e.children(t)},Provider:function(e){var o,l=this;return this.getChildContext||(o=[],this.getChildContext=function(){return t[n.__c]=l,t},this.shouldComponentUpdate=function(t){e.value!==t.value&&o.some(function(e){e.context=t.value,k(e)})},this.sub=function(e){o.push(e);var t=e.componentWillUnmount;e.componentWillUnmount=function(){o.splice(o.indexOf(e),1),t&&t.call(e)}}),e.children}};return n.Consumer.contextType=n,n}exports.isValidElement=t,exports.options=e,exports.options=e={__e:function(e,t){for(var n,o;t=t.__;)if((n=t.__c)&&!n.__)try{if(n.constructor&&null!=n.constructor.getDerivedStateFromError&&(o=!0,n.setState(n.constructor.getDerivedStateFromError(e))),null!=n.componentDidCatch&&(o=!0,n.componentDidCatch(e)),o)return k(n.__E=n)}catch(t){e=t}throw e}},exports.isValidElement=t=function(e){return null!=e&&void 0===e.constructor},y.prototype.setState=function(e,t){var n;n=this.__s!==this.state?this.__s:this.__s=p({},this.state),"function"==typeof e&&(e=e(n,this.props)),e&&p(n,e),null!=e&&this.__v&&(t&&this.__h.push(t),k(this))},y.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),k(this))},y.prototype.render=v,n=[],o=0,l="function"==typeof Promise?Promise.prototype.then.bind(Promise.resolve()):setTimeout,_=u,i=0;
},{}],"MwGB":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.useState=s,exports.useReducer=a,exports.useEffect=p,exports.useLayoutEffect=h,exports.useRef=v,exports.useImperativeHandle=m,exports.useMemo=H,exports.useCallback=l,exports.useContext=d,exports.useDebugValue=x,exports.useErrorBoundary=y;var _,n,t,o=require("preact"),e=[],u=o.options.__r,r=o.options.diffed,i=o.options.__c,c=o.options.unmount;function f(_){o.options.__h&&o.options.__h(n);var t=n.__H||(n.__H={__:[],__h:[]});return _>=t.__.length&&t.__.push({}),t.__[_]}function s(_){return a(q,_)}function a(t,o,e){var u=f(_++);return u.__c||(u.__c=n,u.__=[e?e(o):q(void 0,o),function(_){var n=t(u.__[0],_);u.__[0]!==n&&(u.__[0]=n,u.__c.setState({}))}]),u.__}function p(t,o){var e=f(_++);D(e.__H,o)&&(e.__=t,e.__H=o,n.__H.__h.push(e))}function h(t,o){var e=f(_++);D(e.__H,o)&&(e.__=t,e.__H=o,n.__h.push(e))}function v(_){return H(function(){return{current:_}},[])}function m(_,n,t){h(function(){"function"==typeof _?_(n()):_&&(_.current=n())},null==t?t:t.concat(_))}function H(n,t){var o=f(_++);return D(o.__H,t)?(o.__H=t,o.__h=n,o.__=n()):o.__}function l(_,n){return H(function(){return _},n)}function d(t){var o=n.context[t.__c];if(!o)return t.__;var e=f(_++);return null==e.__&&(e.__=!0,o.sub(n)),o.props.value}function x(_,n){o.options.useDebugValue&&o.options.useDebugValue(n?n(_):_)}function y(t){var o=f(_++),e=s();return o.__=t,n.componentDidCatch||(n.componentDidCatch=function(_){o.__&&o.__(_),e[1](_)}),[e[0],function(){e[1](void 0)}]}function E(){e.some(function(_){if(_.__P)try{_.__H.__h.forEach(b),_.__H.__h.forEach(g),_.__H.__h=[]}catch(n){return o.options.__e(n,_.__v),!0}}),e=[]}function b(_){_.t&&_.t()}function g(_){var n=_.__();"function"==typeof n&&(_.t=n)}function D(_,n){return!_||n.some(function(n,t){return n!==_[t]})}function q(_,n){return"function"==typeof n?n(_):n}o.options.__r=function(t){u&&u(t),_=0,(n=t.__c).__H&&(n.__H.__h.forEach(b),n.__H.__h.forEach(g),n.__H.__h=[])},o.options.diffed=function(_){r&&r(_);var n=_.__c;if(n){var u=n.__H;u&&u.__h.length&&(1!==e.push(n)&&t===o.options.requestAnimationFrame||((t=o.options.requestAnimationFrame)||function(_){var n,t=function(){clearTimeout(o),cancelAnimationFrame(n),setTimeout(_)},o=setTimeout(t,100);"undefined"!=typeof window&&(n=requestAnimationFrame(t))})(E))}},o.options.__c=function(_,n){n.some(function(_){try{_.__h.forEach(b),_.__h=_.__h.filter(function(_){return!_.__||g(_)})}catch(t){n.some(function(_){_.__h&&(_.__h=[])}),n=[],o.options.__e(t,_.__v)}}),i&&i(_,n)},o.options.unmount=function(_){c&&c(_);var n=_.__c;if(n){var t=n.__H;if(t)try{t.__.forEach(function(_){return _.t&&_.t()})}catch(_){o.options.__e(_,n.__v)}}};
},{"preact":"aSor"}],"AQ6k":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e={version:!0,Children:!0,render:!0,hydrate:!0,unmountComponentAtNode:!0,createPortal:!0,createFactory:!0,cloneElement:!0,isValidElement:!0,findDOMNode:!0,PureComponent:!0,memo:!0,forwardRef:!0,unstable_batchedUpdates:!0,Suspense:!0,SuspenseList:!0,lazy:!0,createElement:!0,createContext:!0,createRef:!0,Fragment:!0,Component:!0};exports.render=E,exports.hydrate=k,exports.unmountComponentAtNode=j,exports.createPortal=C,exports.createFactory=A,exports.cloneElement=U,exports.isValidElement=S,exports.findDOMNode=F,exports.memo=a,exports.forwardRef=l,exports.Suspense=d,exports.SuspenseList=v,exports.lazy=m,Object.defineProperty(exports,"createElement",{enumerable:!0,get:function(){return n.createElement}}),Object.defineProperty(exports,"createContext",{enumerable:!0,get:function(){return n.createContext}}),Object.defineProperty(exports,"createRef",{enumerable:!0,get:function(){return n.createRef}}),Object.defineProperty(exports,"Fragment",{enumerable:!0,get:function(){return n.Fragment}}),Object.defineProperty(exports,"Component",{enumerable:!0,get:function(){return n.Component}}),exports.unstable_batchedUpdates=exports.PureComponent=exports.Children=exports.version=exports.default=void 0;var t=require("preact/hooks");Object.keys(t).forEach(function(n){"default"!==n&&"__esModule"!==n&&(Object.prototype.hasOwnProperty.call(e,n)||Object.defineProperty(exports,n,{enumerable:!0,get:function(){return t[n]}}))});var n=require("preact");function r(e,t){for(var n in t)e[n]=t[n];return e}function o(e,t){for(var n in e)if("__source"!==n&&!(n in t))return!0;for(var r in t)if("__source"!==r&&e[r]!==t[r])return!0;return!1}var u=function(e){var t,n;function r(t){var n;return(n=e.call(this,t)||this).isPureReactComponent=!0,n}return n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n,r.prototype.shouldComponentUpdate=function(e,t){return o(this.props,e)||o(this.state,t)},r}(n.Component);function a(e,t){function u(e){var n=this.props.ref,r=n==e.ref;return!r&&n&&(n.call?n(null):n.current=null),t?!t(this.props,e)||!r:o(this.props,e)}function a(t){return this.shouldComponentUpdate=u,(0,n.createElement)(e,r({},t))}return a.prototype.isReactComponent=!0,a.displayName="Memo("+(e.displayName||e.name)+")",a.t=!0,a}exports.PureComponent=u;var i=n.options.__b;function l(e){function t(t){var n=r({},t);return delete n.ref,e(n,t.ref)}return t.prototype.isReactComponent=t.t=!0,t.displayName="ForwardRef("+(e.displayName||e.name)+")",t}n.options.__b=function(e){e.type&&e.type.t&&e.ref&&(e.props.ref=e.ref,e.ref=null),i&&i(e)};var c=function(e,t){return e?(0,n.toChildArray)(e).reduce(function(e,n,r){return e.concat(t(n,r))},[]):null},p={map:c,forEach:c,count:function(e){return e?(0,n.toChildArray)(e).length:0},only:function(e){if(1!==(e=(0,n.toChildArray)(e)).length)throw new Error("Children.only() expects only one child.");return e[0]},toArray:n.toChildArray},s=n.options.__e;function f(e){return e&&((e=r({},e)).__c=null,e.__k=e.__k&&e.__k.map(f)),e}function d(e){this.__u=0,this.o=null,this.__b=null}function _(e){var t=e.__.__c;return t&&t.u&&t.u(e)}function m(e){var t,r,o;function u(u){if(t||(t=e()).then(function(e){r=e.default||e},function(e){o=e}),o)throw o;if(!r)throw t;return(0,n.createElement)(r,u)}return u.displayName="Lazy",u.t=!0,u}function v(){this.i=null,this.l=null}exports.Children=p,n.options.__e=function(e,t,n){if(e.then)for(var r,o=t;o=o.__;)if((r=o.__c)&&r.__c)return r.__c(e,t.__c);s(e,t,n)},(d.prototype=new n.Component).__c=function(e,t){var n=this;null==n.o&&(n.o=[]),n.o.push(t);var r=_(n.__v),o=!1,u=function(){o||(o=!0,r?r(a):a())};t.__c=t.componentWillUnmount,t.componentWillUnmount=function(){u(),t.__c&&t.__c()};var a=function(){var e;if(!--n.__u)for(n.__v.__k[0]=n.state.u,n.setState({u:n.__b=null});e=n.o.pop();)e.forceUpdate()};n.__u++||n.setState({u:n.__b=n.__v.__k[0]}),e.then(u,u)},d.prototype.render=function(e,t){return this.__b&&(this.__v.__k[0]=f(this.__b),this.__b=null),[(0,n.createElement)(n.Component,null,t.u?null:e.children),t.u&&e.fallback]};var h=function(e,t,n){if(++n[1]===n[0]&&e.l.delete(t),e.props.revealOrder&&("t"!==e.props.revealOrder[0]||!e.l.size))for(n=e.i;n;){for(;n.length>3;)n.pop()();if(n[1]<n[0])break;e.i=n=n[2]}};(v.prototype=new n.Component).u=function(e){var t=this,n=_(t.__v),r=t.l.get(e);return r[0]++,function(o){var u=function(){t.props.revealOrder?(r.push(o),h(t,e,r)):o()};n?n(u):u()}},v.prototype.render=function(e){this.i=null,this.l=new Map;var t=(0,n.toChildArray)(e.children);e.revealOrder&&"b"===e.revealOrder[0]&&t.reverse();for(var r=t.length;r--;)this.l.set(t[r],this.i=[1,0,this.i]);return e.children},v.prototype.componentDidUpdate=v.prototype.componentDidMount=function(){var e=this;e.l.forEach(function(t,n){h(e,n,t)})};var y=function(){function e(){}var t=e.prototype;return t.getChildContext=function(){return this.props.context},t.render=function(e){return e.children},e}();function b(e){var t=this,r=e.container,o=(0,n.createElement)(y,{context:t.context},e.vnode);return t.s&&t.s!==r&&(t.v.parentNode&&t.s.removeChild(t.v),(0,n._unmount)(t.h),t.p=!1),e.vnode?t.p?(r.__k=t.__k,(0,n.render)(o,r),t.__k=r.__k):(t.v=document.createTextNode(""),(0,n.hydrate)("",r),r.appendChild(t.v),t.p=!0,t.s=r,(0,n.render)(o,r,t.v),t.__k=t.v.__k):t.p&&(t.v.parentNode&&t.s.removeChild(t.v),(0,n._unmount)(t.h)),t.h=o,t.componentWillUnmount=function(){t.v.parentNode&&t.s.removeChild(t.v),(0,n._unmount)(t.h)},null}function C(e,t){return(0,n.createElement)(b,{vnode:e,container:t})}var x=/^(?:accent|alignment|arabic|baseline|cap|clip(?!PathU)|color|fill|flood|font|glyph(?!R)|horiz|marker(?!H|W|U)|overline|paint|stop|strikethrough|stroke|text(?!L)|underline|unicode|units|v|vector|vert|word|writing|x(?!C))[A-Z]/;n.Component.prototype.isReactComponent={};var g="undefined"!=typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103;function E(e,t,r){if(null==t.__k)for(;t.firstChild;)t.removeChild(t.firstChild);return(0,n.render)(e,t),"function"==typeof r&&r(),e?e.__c:null}function k(e,t,r){return(0,n.hydrate)(e,t),"function"==typeof r&&r(),e?e.__c:null}var P=n.options.event;function N(e,t){e["UNSAFE_"+t]&&!e[t]&&Object.defineProperty(e,t,{configurable:!1,get:function(){return this["UNSAFE_"+t]},set:function(e){this["UNSAFE_"+t]=e}})}n.options.event=function(e){P&&(e=P(e)),e.persist=function(){};var t=!1,n=!1,r=e.stopPropagation;e.stopPropagation=function(){r.call(e),t=!0};var o=e.preventDefault;return e.preventDefault=function(){o.call(e),n=!0},e.isPropagationStopped=function(){return t},e.isDefaultPrevented=function(){return n},e.nativeEvent=e};var O={configurable:!0,get:function(){return this.class}},R=n.options.vnode;n.options.vnode=function(e){e.$$typeof=g;var t=e.type,r=e.props;if(r.class!=r.className&&(O.enumerable="className"in r,null!=r.className&&(r.class=r.className),Object.defineProperty(r,"className",O)),"function"!=typeof t){var o,u,a;for(a in r.defaultValue&&void 0!==r.value&&(r.value||0===r.value||(r.value=r.defaultValue),delete r.defaultValue),Array.isArray(r.value)&&r.multiple&&"select"===t&&((0,n.toChildArray)(r.children).forEach(function(e){-1!=r.value.indexOf(e.props.value)&&(e.props.selected=!0)}),delete r.value),r)if(o=x.test(a))break;if(o)for(a in u=e.props={},r)u[x.test(a)?a.replace(/([A-Z0-9])/,"-$1").toLowerCase():a]=r[a]}!function(t){var n=e.type,r=e.props;if(r&&"string"==typeof n){var o={};for(var u in r)/^on(Ani|Tra|Tou)/.test(u)&&(r[u.toLowerCase()]=r[u],delete r[u]),o[u.toLowerCase()]=u;if(o.ondoubleclick&&(r.ondblclick=r[o.ondoubleclick],delete r[o.ondoubleclick]),o.onbeforeinput&&(r.onbeforeinput=r[o.onbeforeinput],delete r[o.onbeforeinput]),o.onchange&&("textarea"===n||"input"===n.toLowerCase()&&!/^fil|che|ra/i.test(r.type))){var a=o.oninput||"oninput";r[a]||(r[a]=r[o.onchange],delete r[o.onchange])}}}(),"function"==typeof t&&!t.m&&t.prototype&&(N(t.prototype,"componentWillMount"),N(t.prototype,"componentWillReceiveProps"),N(t.prototype,"componentWillUpdate"),t.m=!0),R&&R(e)};var w="16.8.0";function A(e){return n.createElement.bind(null,e)}function S(e){return!!e&&e.$$typeof===g}function U(e){return S(e)?n.cloneElement.apply(null,arguments):e}function j(e){return!!e.__k&&((0,n.render)(null,e),!0)}function F(e){return e&&(e.base||1===e.nodeType&&e)||null}exports.version=w;var L=function(e,t){return e(t)};exports.unstable_batchedUpdates=L;var M={useState:t.useState,useReducer:t.useReducer,useEffect:t.useEffect,useLayoutEffect:t.useLayoutEffect,useRef:t.useRef,useImperativeHandle:t.useImperativeHandle,useMemo:t.useMemo,useCallback:t.useCallback,useContext:t.useContext,useDebugValue:t.useDebugValue,version:"16.8.0",Children:p,render:E,hydrate:E,unmountComponentAtNode:j,createPortal:C,createElement:n.createElement,createContext:n.createContext,createFactory:A,cloneElement:U,createRef:n.createRef,Fragment:n.Fragment,isValidElement:S,findDOMNode:F,Component:n.Component,PureComponent:u,memo:a,forwardRef:l,unstable_batchedUpdates:L,Suspense:d,SuspenseList:v,lazy:m};exports.default=M;
},{"preact/hooks":"MwGB","preact":"aSor"}],"vnR2":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;const e={remove:e=>document.getElementById(e).outerHTML="",add:(t,r="alert-success",d=5e3)=>{if(!t)return;let l=document.createElement("DIV");l.id=e.hash(t),l.innerHTML=t,l.classList.add("global-alert","alert",r),document.body.appendChild(l),setTimeout(()=>e.remove(l.id),d)},hash:e=>{let t=0;if(0==e.length)return t;for(let r=0;r<e.length;r++){t=(t<<5)-t+e.charCodeAt(r),t&=t}return t}};var t=e;exports.default=t;
},{}],"vRk2":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.get=o,exports.set=n,exports.del=s,exports.clear=i,exports.keys=u,exports.Store=void 0;class e{constructor(e="keyval-store",t="keyval"){this.storeName=t,this._dbp=new Promise((r,o)=>{const n=indexedDB.open(e,1);n.onerror=(()=>o(n.error)),n.onsuccess=(()=>r(n.result)),n.onupgradeneeded=(()=>{n.result.createObjectStore(t)})})}_withIDBStore(e,t){return this._dbp.then(r=>new Promise((o,n)=>{const s=r.transaction(this.storeName,e);s.oncomplete=(()=>o()),s.onabort=s.onerror=(()=>n(s.error)),t(s.objectStore(this.storeName))}))}}let t;function r(){return t||(t=new e),t}function o(e,t=r()){let o;return t._withIDBStore("readonly",t=>{o=t.get(e)}).then(()=>o.result)}function n(e,t,o=r()){return o._withIDBStore("readwrite",r=>{r.put(t,e)})}function s(e,t=r()){return t._withIDBStore("readwrite",t=>{t.delete(e)})}function i(e=r()){return e._withIDBStore("readwrite",e=>{e.clear()})}function u(e=r()){const t=[];return e._withIDBStore("readonly",e=>{(e.openKeyCursor||e.openCursor).call(e).onsuccess=function(){this.result&&(t.push(this.result.key),this.result.continue())}}).then(()=>t)}exports.Store=e;
},{}],"NUMl":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=require("idb-keyval");const a="4.1",l="0.2",o="zusam-4.1-simplecache-0.2",r={name:o,cache_store:new t.Store("zusam-4.1",o),purgeOldCache:e=>{(0,t.keys)().then(e=>e.map(e=>(0,t.get)(e).then(a=>{a.lastUsed+2592e6<Date.now()&&(console.log("Remove from cache: "+e.url),(0,t.del)(e),caches.open(r.name).then(t=>t.delete(e)))})))},removeMatching:t=>caches.open(r.name).then(a=>a.matchAll().then(l=>Promise.all(l.filter(e=>e.url.match(t)).map(t=>a.delete(e)))))};var c=r;exports.default=c;
},{"idb-keyval":"vRk2"}],"EDnG":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;const e={usage:e=>{let t,a=0;for(t in localStorage)localStorage.hasOwnProperty(t)&&(a+=2*(localStorage[t].length+t.length));return a},createStorageBox:(e,t=null)=>({data:e,createdAt:Date.now(),metadata:t}),remove:e=>localStorage.removeItem(e),set:(t,a,r=null)=>(localStorage.setItem(t,JSON.stringify(e.createStorageBox(a,r))),Promise.resolve(t)),get:e=>{let t=localStorage.getItem(e);return null!=t&&(t=JSON.parse(t)).hasOwnProperty("data")?new Promise(e=>e(t.data)):new Promise(e=>e(null))},reset:e=>localStorage.clear()&&window.dispatchEvent(new CustomEvent("resetStorage"))};var t=e;exports.default=t;
},{}],"DIJp":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=i(require("./http.js")),e=i(require("./lang.js"));function i(t){return t&&t.__esModule?t:{default:t}}const o={me:{},get:()=>o.me.id?Promise.resolve(o.me):o.update(),update:()=>t.default.get("/api/me",!0).then(t=>{if(t)return o.me=Object.assign({notifications:[]},t),o.loadNotifications(),e.default.fetchDict(),window.dispatchEvent(new CustomEvent("meStateChange")),t}),loadNotifications:()=>t.default.get("/api/users/"+o.me.id+"/notifications").then(t=>{o.me.notifications=t,window.dispatchEvent(new CustomEvent("meStateChange"))}),matchNotification:(t,e)=>t.id===e||t.target===e,isNew:t=>!!Array.isArray(o.me.notifications)&&o.me.notifications.some(e=>o.matchNotification(e,t)||"new_comment"==e.type&&e.fromMessage.id===t),removeMatchingNotifications:e=>o.loadNotifications().then(i=>Array.isArray(o.me.notifications)?Promise.all(o.me.notifications.filter(t=>o.matchNotification(t,e)).map(i=>t.default.delete("/api/notifications/"+i.id).then(t=>{o.me.notifications=o.me.notifications.filter(t=>!o.matchNotification(t,e)),window.dispatchEvent(new CustomEvent("meStateChange"))}))):Promise.reject("Failed to get notifications from server"))};var a=o;exports.default=a;
},{"./http.js":"MqMR","./lang.js":"dg0a"}],"dg0a":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=a(require("./me.js")),t=a(require("./http.js"));function a(e){return e&&e.__esModule?e:{default:e}}const n={dict:[],possibleLang:{en:"English",es:"Español",fr:"Français",sk:"Slovenský"},getDefaultLang:()=>(document.querySelector("meta[name='zusam:default-lang']")||{}).content||"en",getCurrentLang:()=>e.default.me&&e.default.me.data&&e.default.me.data.lang||n.getDefaultLang(),fetchDict:(e=n.getCurrentLang())=>!n.dict[e]&&t.default.get("/lang/"+e+".json").then(t=>{n.dict[e]=t,window.dispatchEvent(new CustomEvent("fetchedNewDict"))}),t:(e,t={})=>{if(t.dict=t.dict||n.getCurrentLang(),t.count=t.count||0,!e||!n.dict[t.dict])return"";let a=n.dict[t.dict][e]||"";if("object"==typeof a){let e=Object.getOwnPropertyNames(a).map(e=>+e).filter(e=>!isNaN(e)&&e<=t.count).sort((e,t)=>e-t);a=e.length?a[e.slice(-1)[0]]:""}return Object.assign([],a.match(/{{\w+}}/g)).forEach(e=>{let n=e.replace(/[\{\}]/g,"");t[n]&&(a=a.replace(e,t[n]))}),a}};var r=n;exports.default=r;
},{"./me.js":"DIJp","./http.js":"MqMR"}],"QBcK":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=n(require("./http.js")),t=n(require("./me.js")),a=n(require("./util.js")),r=n(require("./lang.js")),i=n(require("./storage.js"));function n(e){return e&&e.__esModule?e:{default:e}}const s={route:"",id:"",action:"",backUrl:"",backUrlPrompt:"",entityUrl:"",entityType:"",search:"",entity:{},isValidUrl:e=>{try{return new URL(e),!0}catch(t){return!1}},getSubpath:()=>new URL(document.baseURI).pathname.replace(/\/$/,""),toApp:e=>e&&"string"==typeof e?s.isValidUrl(e)?e:location.origin+s.getSubpath()+e:"",removeSubpath:e=>e?e.replace(new RegExp("^"+s.getSubpath()),""):"",getParam:(e,t=window.location.search.substring(1))=>{let a=t.split("&").find(t=>t.split("=")[0]===e);return a?a.split("=")[1]:""},getSegments:()=>window.location.pathname.slice(1).split("?")[0].split("/"),isOutside:()=>["login","password-reset","signup","invitation","stop-notification-emails","public"].includes(s.route||s.getSegments()[0]),isEntity:e=>["messages","groups","users","links","files"].includes(e),getUrlComponents:e=>{let t={};return e&&(t.url=new URL(e),t.path=t.url.pathname,t.search=t.url.search.slice(1),[t.route,t.id,t.action]=s.removeSubpath(t.path).slice(1).split("/")),t.entityUrl="",t.entityType="",t.backUrl="",t.backUrlPrompt="",t},navigate:async(n="/",o={})=>{n.match(/^http/)||o.raw_url||(n=s.toApp(n));let l=s.getUrlComponents(n);if(s.url&&s.url.href==l.url.href)console.warn("navigate lock !");else switch(Object.assign(s,l),s.route&&s.id&&s.isEntity(s.route)&&(s.entityUrl="/api/"+s.route+"/"+s.id,s.entityType=s.route,await e.default.get(s.entityUrl).then(e=>{if(!e)return console.warn("Unknown entity"),void s.navigate();switch(s.entity=e,s.route){case"groups":"write"==s.action&&(s.backUrl="/"+s.route+"/"+s.id,s.backUrlPrompt=r.default.t("cancel_write")),s.search&&(s.backUrl="/"+s.route+"/"+s.id);break;case"messages":e.parent&&!e.isInFront?s.backUrl="/messages/"+e.parent.id:s.backUrl="/groups/"+a.default.getId(e.group);break;case"users":s.backUrl="/";break;default:s.action&&(s.backUrl="/")}}).catch(e=>console.warn(e))),s.route){case"login":i.default.reset();case"create-group":case"groups":case"messages":case"password-reset":case"public":case"share":case"signup":case"stop-notification-emails":case"users":o.replace?history.replaceState(null,"",n):history.pushState(null,"",n),window.dispatchEvent(new CustomEvent("routerStateChange"));break;case"logout":i.default.reset(),window.location.href=window.location.origin;break;case"invitation":i.default.get("apiKey").then(t=>{t?e.default.post("/api/groups/invitation/"+s.id,{}).then(e=>{window.location.href=window.location.origin}):s.navigate("/signup?inviteKey="+s.id)});break;default:t.default.get().then(e=>{e?e.data.default_group?s.navigate("/groups/"+e.data.default_group):e.groups[0]?s.navigate("/groups/"+e.groups[0].id):window.location="/create-group":s.navigate("/login")})}},sync:()=>{s.navigate(location.pathname+location.search+location.hash,{replace:!0})},onClick:(e,t=!1,a=null)=>{if(e.preventDefault(),e.stopPropagation(),!a){const r=e.target.closest("a");r&&("_blank"==r.target&&(t=!0),a=r.getAttribute("href"))}if(a){if(a.startsWith("http")){if(new URL(a).host!=location.host)return void(e.ctrlKey||t?open(a,"_blank"):location.href=a)}for(let e of document.getElementsByClassName("active"))e.classList.remove("active");e.ctrlKey||t?open(a,"_blank"):s.navigate(a)}}};var o=s;exports.default=o;
},{"./http.js":"MqMR","./me.js":"DIJp","./util.js":"O1i9","./lang.js":"dg0a","./storage.js":"EDnG"}],"O1i9":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=r(require("./lang.js")),t=r(require("./router.js")),a=r(require("./me.js"));function r(e){return e&&e.__esModule?e:{default:e}}const n={urlRegExp:new RegExp("(\\([^()]*)?https?:\\/\\/[-A-Za-z0-9+&@#/%?=~_()|!:,.;*]*[-A-Za-z0-9+&@#/%=~_()|]","i"),getUrl:e=>{if(!e)return"";let t=e.match(n.urlRegExp);if(t&&t[0].startsWith("(")){let e=t[0].match(/https?:\/\//i);t.index+=e.index,t[0]=t[0].slice(e.index),t[0].endsWith(")")&&(t[0]=t[0].slice(0,-1))}return t},humanFullDate:e=>{let t=new Date(1e3*e);return(t=new Date(t.getTime()+6e4*t.getTimezoneOffset()*-1)).toISOString().replace("T"," ").replace(/\..*$/,"")},humanTime:t=>{if(!t)return null;const a=Math.abs(Math.round((Date.now()/1e3-t)/60));if(a<1)return e.default.t("just_now");if(a<60)return e.default.t("ago",{duration:a+"mn"});if(a<1440)return e.default.t("ago",{duration:Math.floor(a/60)+"h"});new Date(1e3*t);return n.humanFullDate(t).split(" ")[0]},getGroupId:e=>{if(a.default.me.groups)switch(t.default.entity.entityType){case"group":return n.getId(t.default.entity);case"message":return n.getId(t.default.entity.group)}return""},getGroupName:e=>{let t=a.default.me.groups.find(e=>e.id==n.getGroupId());return t?t.name:""},getId:e=>{switch(typeof e){case"object":return e?e.id:null;case"string":return e.split("/").pop().replace(/\?.*$/,"").replace(/\.\w+$/,"");default:throw console.warn(e),"Could not extract id !"}},thumbnail:(e,a,r)=>e?t.default.toApp("/api/images/thumbnail/"+a+"/"+r+"/"+e):null,crop:(e,a,r)=>e?t.default.toApp("/api/images/crop/"+a+"/"+r+"/"+e):null,defaultAvatar:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAABlBMVEUAAAD///+l2Z/dAAAAAnRSTlMA/iyWEiMAAAMJSURBVHja7ZtBjpwwEEWxmIhFFmiURZZEyi6HCLkZHCXr2eQKHIUjoEiRSGRRiWB6klaDU/hDF4z+W6LuNz3+ZRvbkCSEEEIIIYQQQgghhBBCCCGEEEIIITvwGfy+kxoTpNJigkw6TJBLjwkK8ZiglMFYUInAAqwQRKRBBR0q8FhXEKwVR0GLCvxCjeo6oyzkoIxnEvj5661acPO3yvFqpxdcV+Pj88VeNZ7cGB4ul1QFkv399KT4KBIpmGEwF4i9oL6DIN/3FzToL2ju8AvsBeE2aNFfQMFJBCkF0/R+bkHyCgSVuaDcVaC5zyvMBTkqyHYVaBZDKSpw5oJgLcMC5doXFBSoIMNutjcQBHJULmlhQYUKlmNQbs9kqGC5P2o3FqBBOVjMWkEOdcZQKam3dyqkkgP/g35zxmEpLhbjir0ZFz2tXHgbPR5deI+EMPKmig/hhU/fIkOYL4iYDbIyqpCXajp2Zy4yhNuxqUfbMCaEIraQZ9swJgQBQ0jBQr6eYXrzQrYIYdtC9uaFbDKayJajyTkL+VijyWA+mnBajGpDeFrMzAu5BNvwKoQBDaFHQ+jQEBo0hBoMYUBD8GgIHRpCi44mcAiJRQhoITvzQs63LGQxL2SOJnEhiHUI296bwNOixb1JYr5kz8yX7Odf6XDfBC9kd6yVzq+np69QIY/8AEJ45kt0T4hIM0VONm5CiLlVhLflS+CwdTGEVa2AnfOFTogaVAAfcg1QivpqzLFHD4LnrR0q8FAhqlux3PPUu0EFLSrooL6kLeaQwKMCTY4OfUjVoY+IOvTxSFiw81NtnbmgRwXeXDAg08IxBPIKBPX5BQ0FBxC0+wtSCg4gcBT853nruwiqfQXNHQT/LDiGD9Old6sEL2umn3MtqxDks9NotVbwfaG+FDfL6fznsjV32365cTXrtqoPdJKYrbmreIDvT42DCMYoIUEu4FvIKSpwgr6JvYEAfJm8QgUl+j58gb6Rn4Nvcv/p0jUmcODr8IQQQgghhBBCCCGEEEIIIYQQQgghs/wGp6uYgtiKODIAAAAASUVORK5CYII=",hash:e=>e.split("").reduce((e,t)=>(e<<5)-e+t.charCodeAt()|0),colorHash:e=>["#000000","#333366","#333399","#3333CC","#339933","#339999","#33CC33","#33CC99","#663333","#663366","#666633","#666699","#66CC33","#66CCCC","#993333","#993366","#993399","#996633","#999966","#CC3333","#CC3366","#CC3399","#CC33CC","#CC6633","#CC9933","#CC99CC","#CCCC33"][Math.abs(n.hash(e))%27],backgroundHash:e=>{if(!e)return"background-color: #aaa;";let t=n.colorHash(e),a=n.colorHash(e.split("").reverse().join("."));return"background-color:"+t+";background-image:linear-gradient("+Math.abs(n.hash(e))%4*45+"deg, "+a+" 15%, transparent 15% 30%, "+a+" 30% 45%, transparent 45% 60%, "+a+" 60% 75%, transparent 75% 90%, "+a+" 90%);"}};var u=n;exports.default=u;
},{"./lang.js":"dg0a","./router.js":"QBcK","./me.js":"DIJp"}],"MqMR":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=s(require("./util.js")),t=s(require("./alert.js")),r=s(require("./storage.js")),a=s(require("./router.js"));function s(e){return e&&e.__esModule?e:{default:e}}const n={sendFile:(e,a,s=null,n=null)=>r.default.get("apiKey").then(t=>{let r=new XMLHttpRequest;r.open("POST",document.baseURI+"api/files",!0),r.setRequestHeader("X-AUTH-TOKEN",t),r.addEventListener("load",e=>{e.target.status>199&&e.target.status<300?a(JSON.parse(e.target.response)):n?n(e.target.statusText):console.error(e.target.statusText)}),s&&(r.upload.onprogress=(e=>s({loaded:e.loaded,total:e.total}))),n&&r.addEventListener("error",e=>n(e)),r.send(e)}).catch(e=>{}).catch(e=>t.default.add(e,"alert-danger")),get:(e,s=!1)=>r.default.get("apiKey").then(t=>{if(!(e=a.default.toApp(e)))return;let r={};return t&&(r["X-AUTH-TOKEN"]=t),s&&(r["X-NOCACHE"]="nocache"),fetch(e,{method:"GET",headers:new Headers(r)}).then(e=>e.ok&&e.json()).catch(t=>console.warn("ERROR for "+e,t))}).catch(e=>t.default.add(e,"alert-danger")),post:(e,t,r="application/json")=>n.request(e,t,"POST",r),put:(e,t,r="application/json")=>n.request(e,t,"PUT",r),delete:(e,t,r="application/json")=>n.request(e,null,"DELETE",r),request:(e,s,n,o="application/json")=>r.default.get("apiKey").then(t=>{if(!(e=a.default.toApp(e)))return;let r={};t&&(r["X-AUTH-TOKEN"]=t),o&&(r["Content-type"]=o);let u={method:n,headers:new Headers(r)};return s&&(u.body="object"==typeof s&&"Object"==s.constructor.name?JSON.stringify(s):s),fetch(e,u).then(e=>{if("DELETE"==n)return e;try{return e.json()}catch(t){return console.warn(t.message),Promise.reject(t.message)}}).catch(t=>console.warn("ERROR for "+e,t))}).catch(e=>t.default.add(e,"alert-danger"))};var o=n;exports.default=o;
},{"./util.js":"O1i9","./alert.js":"vnR2","./storage.js":"EDnG","./router.js":"QBcK"}],"rqMW":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.lang=exports.util=exports.router=exports.me=exports.http=exports.storage=exports.cache=exports.alert=void 0;var e=p(require("./alert.js")),t=p(require("./cache.js")),r=p(require("./storage.js")),s=p(require("./http.js")),o=p(require("./me.js")),u=p(require("./router.js")),a=p(require("./util.js")),l=p(require("./lang.js"));function p(e){return e&&e.__esModule?e:{default:e}}const c=e.default;exports.alert=c;const x=t.default;exports.cache=x;const i=r.default;exports.storage=i;const n=s.default;exports.http=n;const d=o.default;exports.me=d;const f=u.default;exports.router=f;const j=a.default;exports.util=j;const q=l.default;exports.lang=q;
},{"./alert.js":"vnR2","./cache.js":"NUMl","./storage.js":"EDnG","./http.js":"MqMR","./me.js":"DIJp","./router.js":"QBcK","./util.js":"O1i9","./lang.js":"dg0a"}],"Kz2q":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var c=require("preact");class l extends c.Component{constructor(c){super(c),this.state={regular:{comment:[512,512,[],"f075","M256 32C114.6 32 0 125.1 0 240c0 47.6 19.9 91.2 52.9 126.3C38 405.7 7 439.1 6.5 439.5c-6.6 7-8.4 17.2-4.6 26S14.4 480 24 480c61.5 0 110-25.7 139.1-46.3C192 442.8 223.2 448 256 448c141.4 0 256-93.1 256-208S397.4 32 256 32zm0 368c-26.7 0-53.1-4.1-78.4-12.1l-22.7-7.2-19.5 13.8c-14.3 10.1-33.9 21.4-57.5 29 7.3-12.1 14.4-25.7 19.9-40.2l10.6-28.1-20.6-21.8C69.7 314.1 48 282.2 48 240c0-88.2 93.3-160 208-160s208 71.8 208 160-93.3 160-208 160z"],images:[576,512,[],"f302","M480 416v16c0 26.51-21.49 48-48 48H48c-26.51 0-48-21.49-48-48V176c0-26.51 21.49-48 48-48h16v48H54a6 6 0 0 0-6 6v244a6 6 0 0 0 6 6h372a6 6 0 0 0 6-6v-10h48zm42-336H150a6 6 0 0 0-6 6v244a6 6 0 0 0 6 6h372a6 6 0 0 0 6-6V86a6 6 0 0 0-6-6zm6-48c26.51 0 48 21.49 48 48v256c0 26.51-21.49 48-48 48H144c-26.51 0-48-21.49-48-48V80c0-26.51 21.49-48 48-48h384zM264 144c0 22.091-17.909 40-40 40s-40-17.909-40-40 17.909-40 40-40 40 17.909 40 40zm-72 96l39.515-39.515c4.686-4.686 12.284-4.686 16.971 0L288 240l103.515-103.515c4.686-4.686 12.284-4.686 16.971 0L480 208v80H192v-48z"],"check-circle":[512,512,[],"f058","M256 8C119.033 8 8 119.033 8 256s111.033 248 248 248 248-111.033 248-248S392.967 8 256 8zm0 48c110.532 0 200 89.451 200 200 0 110.532-89.451 200-200 200-110.532 0-200-89.451-200-200 0-110.532 89.451-200 200-200m140.204 130.267l-22.536-22.718c-4.667-4.705-12.265-4.736-16.97-.068L215.346 303.697l-59.792-60.277c-4.667-4.705-12.265-4.736-16.97-.069l-22.719 22.536c-4.705 4.667-4.736 12.265-.068 16.971l90.781 91.516c4.667 4.705 12.265 4.736 16.97.068l172.589-171.204c4.704-4.668 4.734-12.266.067-16.971z"],"file-pdf":[384,512,[],"f1c1","M369.9 97.9L286 14C277 5 264.8-.1 252.1-.1H48C21.5 0 0 21.5 0 48v416c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48V131.9c0-12.7-5.1-25-14.1-34zM332.1 128H256V51.9l76.1 76.1zM48 464V48h160v104c0 13.3 10.7 24 24 24h104v288H48zm250.2-143.7c-12.2-12-47-8.7-64.4-6.5-17.2-10.5-28.7-25-36.8-46.3 3.9-16.1 10.1-40.6 5.4-56-4.2-26.2-37.8-23.6-42.6-5.9-4.4 16.1-.4 38.5 7 67.1-10 23.9-24.9 56-35.4 74.4-20 10.3-47 26.2-51 46.2-3.3 15.8 26 55.2 76.1-31.2 22.4-7.4 46.8-16.5 68.4-20.1 18.9 10.2 41 17 55.8 17 25.5 0 28-28.2 17.5-38.7zm-198.1 77.8c5.1-13.7 24.5-29.5 30.4-35-19 30.3-30.4 35.7-30.4 35zm81.6-190.6c7.4 0 6.7 32.1 1.8 40.8-4.4-13.9-4.3-40.8-1.8-40.8zm-24.4 136.6c9.7-16.9 18-37 24.7-54.7 8.3 15.1 18.9 27.2 30.1 35.5-20.8 4.3-38.9 13.1-54.8 19.2zm131.6-5s-5 6-37.3-7.8c35.1-2.6 40.9 5.4 37.3 7.8z"],bell:[448,512,[],"f0f3","M439.39 362.29c-19.32-20.76-55.47-51.99-55.47-154.29 0-77.7-54.48-139.9-127.94-155.16V32c0-17.67-14.32-32-31.98-32s-31.98 14.33-31.98 32v20.84C118.56 68.1 64.08 130.3 64.08 208c0 102.3-36.15 133.53-55.47 154.29-6 6.45-8.66 14.16-8.61 21.71.11 16.4 12.98 32 32.1 32h383.8c19.12 0 32-15.6 32.1-32 .05-7.55-2.61-15.27-8.61-21.71zM67.53 368c21.22-27.97 44.42-74.33 44.53-159.42 0-.2-.06-.38-.06-.58 0-61.86 50.14-112 112-112s112 50.14 112 112c0 .2-.06.38-.06.58.11 85.1 23.31 131.46 44.53 159.42H67.53zM224 512c35.32 0 63.97-28.65 63.97-64H160.03c0 35.35 28.65 64 63.97 64z"]},solid:{comment:[512,512,[],"f075","M256 32C114.6 32 0 125.1 0 240c0 49.6 21.4 95 57 130.7C44.5 421.1 2.7 466 2.2 466.5c-2.2 2.3-2.8 5.7-1.5 8.7S4.8 480 8 480c66.3 0 116-31.8 140.6-51.4 32.7 12.3 69 19.4 107.4 19.4 141.4 0 256-93.1 256-208S397.4 32 256 32z"],"pencil-alt":[512,512,[],"f303","M497.9 142.1l-46.1 46.1c-4.7 4.7-12.3 4.7-17 0l-111-111c-4.7-4.7-4.7-12.3 0-17l46.1-46.1c18.7-18.7 49.1-18.7 67.9 0l60.1 60.1c18.8 18.7 18.8 49.1 0 67.9zM284.2 99.8L21.6 362.4.4 483.9c-2.9 16.4 11.4 30.6 27.8 27.8l121.5-21.3 262.6-262.6c4.7-4.7 4.7-12.3 0-17l-111-111c-4.8-4.7-12.4-4.7-17.1 0zM124.1 339.9c-5.5-5.5-5.5-14.3 0-19.8l154-154c5.5-5.5 14.3-5.5 19.8 0s5.5 14.3 0 19.8l-154 154c-5.5 5.5-14.3 5.5-19.8 0zM88 424h48v36.3l-64.5 11.3-31.1-31.1L51.7 376H88v48z"],"arrow-left":[448,512,[],"f060","M257.5 445.1l-22.2 22.2c-9.4 9.4-24.6 9.4-33.9 0L7 273c-9.4-9.4-9.4-24.6 0-33.9L201.4 44.7c9.4-9.4 24.6-9.4 33.9 0l22.2 22.2c9.5 9.5 9.3 25-.4 34.3L136.6 216H424c13.3 0 24 10.7 24 24v32c0 13.3-10.7 24-24 24H136.6l120.5 114.8c9.8 9.3 10 24.8.4 34.3z"],"caret-down":[320,512,[],"f0d7","M31.3 192h257.3c17.8 0 26.7 21.5 14.1 34.1L174.1 354.8c-7.8 7.8-20.5 7.8-28.3 0L17.2 226.1C4.6 213.5 13.5 192 31.3 192z"],film:[512,512,[],"f008","M488 64h-8v20c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12V64H96v20c0 6.6-5.4 12-12 12H44c-6.6 0-12-5.4-12-12V64h-8C10.7 64 0 74.7 0 88v336c0 13.3 10.7 24 24 24h8v-20c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v20h320v-20c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v20h8c13.3 0 24-10.7 24-24V88c0-13.3-10.7-24-24-24zM96 372c0 6.6-5.4 12-12 12H44c-6.6 0-12-5.4-12-12v-40c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40zm0-96c0 6.6-5.4 12-12 12H44c-6.6 0-12-5.4-12-12v-40c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40zm0-96c0 6.6-5.4 12-12 12H44c-6.6 0-12-5.4-12-12v-40c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40zm272 208c0 6.6-5.4 12-12 12H156c-6.6 0-12-5.4-12-12v-96c0-6.6 5.4-12 12-12h200c6.6 0 12 5.4 12 12v96zm0-168c0 6.6-5.4 12-12 12H156c-6.6 0-12-5.4-12-12v-96c0-6.6 5.4-12 12-12h200c6.6 0 12 5.4 12 12v96zm112 152c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12v-40c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40zm0-96c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12v-40c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40zm0-96c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12v-40c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40z"],times:[352,512,[],"f00d","M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"],bell:[448,512,[],"f0f3","M224 512c35.32 0 63.97-28.65 63.97-64H160.03c0 35.35 28.65 64 63.97 64zm215.39-149.71c-19.32-20.76-55.47-51.99-55.47-154.29 0-77.7-54.48-139.9-127.94-155.16V32c0-17.67-14.32-32-31.98-32s-31.98 14.33-31.98 32v20.84C118.56 68.1 64.08 130.3 64.08 208c0 102.3-36.15 133.53-55.47 154.29-6 6.45-8.66 14.16-8.61 21.71.11 16.4 12.98 32 32.1 32h383.8c19.12 0 32-15.6 32.1-32 .05-7.55-2.61-15.27-8.61-21.71z"],"ellipsis-h":[512,512,[],"f141","M328 256c0 39.8-32.2 72-72 72s-72-32.2-72-72 32.2-72 72-72 72 32.2 72 72zm104-72c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72zm-352 0c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72z"],search:[512,512,[],"f002","M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"]}}}render(){const l=this.state[this.props.family][this.props.icon];return l&&(0,c.h)("svg",{className:"fa-icon "+this.props.family+" "+this.props.icon,viewBox:"0 0 "+l[0]+" "+l[1]},(0,c.h)("path",{fill:"currentColor",d:l[4]}))}}exports.default=l;
},{"preact":"aSor"}],"V5Rv":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.FaIcon=void 0;var e=o(require("./fa-icon.component.js"));function o(e){return e&&e.__esModule?e:{default:e}}const t=e.default;exports.FaIcon=t;
},{"./fa-icon.component.js":"Kz2q"}],"FheM":[function(require,module,exports) {
var t=null;function e(){return t||(t=n()),t}function n(){try{throw new Error}catch(e){var t=(""+e.stack).match(/(https?|file|ftp|chrome-extension|moz-extension):\/\/[^)\n]+/g);if(t)return r(t[0])}return"/"}function r(t){return(""+t).replace(/^((?:https?|file|ftp|chrome-extension|moz-extension):\/\/.+)\/[^/]+$/,"$1")+"/"}exports.getBundleURL=e,exports.getBaseURL=r;
},{}],"TUK3":[function(require,module,exports) {
var r=require("./bundle-url").getBundleURL;function e(r){Array.isArray(r)||(r=[r]);var e=r[r.length-1];try{return Promise.resolve(require(e))}catch(n){if("MODULE_NOT_FOUND"===n.code)return new s(function(n,i){t(r.slice(0,-1)).then(function(){return require(e)}).then(n,i)});throw n}}function t(r){return Promise.all(r.map(u))}var n={};function i(r,e){n[r]=e}module.exports=exports=e,exports.load=t,exports.register=i;var o={};function u(e){var t;if(Array.isArray(e)&&(t=e[1],e=e[0]),o[e])return o[e];var i=(e.substring(e.lastIndexOf(".")+1,e.length)||e).toLowerCase(),u=n[i];return u?o[e]=u(r()+e).then(function(r){return r&&module.bundle.register(t,r),r}).catch(function(r){throw delete o[e],r}):void 0}function s(r){this.executor=r,this.promise=null}s.prototype.then=function(r,e){return null===this.promise&&(this.promise=new Promise(this.executor)),this.promise.then(r,e)},s.prototype.catch=function(r){return null===this.promise&&(this.promise=new Promise(this.executor)),this.promise.catch(r)};
},{"./bundle-url":"FheM"}],"FklW":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("preact"),i=require("/core"),l=require("/misc");class r extends e.Component{constructor(e){super(e),this.toggleFile=this.toggleFile.bind(this);let i=[];Array.isArray(e.files)&&e.files.forEach((e,l)=>{null==e.fileIndex&&(e.fileIndex=l),i.splice(e.fileIndex,0,e)}),this.state={files:i}}toggleFile(e,i){e.stopPropagation(),e.preventDefault(),"function"==typeof this.props.toggleFile&&this.props.toggleFile(e.currentTarget.getAttribute("fileIndex"))}renderFile(r,t=!1){let s=r.contentUrl?"/files/"+r.contentUrl:null,n=s;if(/image/.test(r.type)&&"image/gif"!=r.type&&(n=i.util.thumbnail(r.id,1366,999999)),1==t)return"ready"==r.status?(0,e.h)("a",{"data-nlg":!this.props.inWriter,"data-origin":s,"data-src":i.util.thumbnail(r.id,1366,768),href:this.props.inWriter?void 0:i.router.toApp(n),class:"rounded"},(0,e.h)("div",{className:"miniature"+(r.removed?" removed":""),style:"background-image:url('"+i.util.crop(r.id,160,160)+"')"}),(0,e.h)("div",{class:"remove-button",style:r.removed?"color:red":"",fileIndex:r.fileIndex,onClick:e=>this.toggleFile(e)},(0,e.h)(l.FaIcon,{family:"solid",icon:"times"}))):"raw"==r.status?(0,e.h)("a",{class:"rounded"},(0,e.h)("div",{class:"miniature"},(0,e.h)(l.FaIcon,{family:"regular",icon:"check-circle"}))):(0,e.h)("a",{class:"rounded"},(0,e.h)("div",{class:"miniature video-raw",style:"background-image:url('"+i.util.crop(r.id,160,160)+"')"}),(0,e.h)("div",{class:"spinner orange-spinner"},(0,e.h)("div",null),(0,e.h)("div",null),(0,e.h)("div",null),(0,e.h)("div",null),(0,e.h)("div",null)));if(r.contentUrl){if(/video/.test(r.type))return"ready"==r.status?(0,e.h)("video",{poster:i.util.thumbnail(r.id,1280,720),class:"img-fluid contained-height video",controls:"true",src:n}):(0,e.h)("a",{class:"image video-uploaded"},(0,e.h)("img",{class:"img-fluid video-raw",src:i.util.crop(r.id,320,180)}),(0,e.h)("div",{class:"spinner orange-spinner"},(0,e.h)("div",null),(0,e.h)("div",null),(0,e.h)("div",null),(0,e.h)("div",null),(0,e.h)("div",null)));if(/image/.test(r.type))return(0,e.h)("a",{"data-nlg":!this.props.inWriter,"data-origin":s,href:this.props.inWriter?void 0:i.router.toApp(n),className:"image"+(r.removed?" removed":"")},(0,e.h)("img",{class:"img-fluid",src:n}),(0,e.h)("div",{class:"remove-button",style:r.removed?"color:red":"",fileIndex:r.fileIndex,onClick:e=>this.toggleFile(e)},(0,e.h)(l.FaIcon,{family:"solid",icon:"times"})))}return(0,e.h)("div",{class:"file-placeholder"},r.error?(0,e.h)("div",{class:"orange-error"},"×"):(0,e.h)("div",{class:"spinner orange-spinner"},(0,e.h)("div",null),(0,e.h)("div",null),(0,e.h)("div",null),(0,e.h)("div",null),(0,e.h)("div",null)),(0,e.h)("div",{class:"progress-bar"},(0,e.h)("div",{style:{width:r.progress+"%"}})))}render(){return this.props.files&&0!==this.props.files.length?this.props.files&&this.props.files.length>3?(0,e.h)("div",{class:"file-grid"},this.state.files.sort((e,i)=>e.fileIndex>i.fileIndex?1:-1).map(e=>this.renderFile(e,!0))):(0,e.h)("div",{class:"d-flex justify-content-center flex-wrap"},this.state.files.sort((e,i)=>e.fileIndex>i.fileIndex?1:-1).map(e=>this.renderFile(e))):null}componentDidMount(){require("_bundle_loader")(require.resolve("/lazy/nlg.js")).then(e=>e.default.start())}componentDidUpdate(){require("_bundle_loader")(require.resolve("/lazy/nlg.js")).then(e=>e.default.start())}}exports.default=r;
},{"preact":"aSor","/core":"rqMW","/misc":"V5Rv","_bundle_loader":"TUK3","/lazy/nlg.js":[["nlg.8ad14ec1.js","vjjh"],"nlg.8ad14ec1.js.map","vjjh"]}],"cVVC":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("preact"),t=require("/core"),s=a(require("./message.component.js"));function a(e){return e&&e.__esModule?e:{default:e}}class i extends e.Component{constructor(e){super(e),this.state={message:this.props.message}}componentDidMount(){t.me.removeMatchingNotifications(this.props.message.id)}componentWillUpdate(){let e=document.getElementById(this.state.message.id);this.state.message.id==t.router.action&&e.classList.contains("highlight")&&setTimeout(t=>{e.scrollIntoView({block:"start",behavior:"smooth"}),setTimeout(t=>e.classList.remove("highlight"),1e3)},1e3)}render(){if(this.state.message&&!this.state.isRemoved)return(0,e.h)(s.default,{message:this.state.message,isPublic:this.props.isPublic,isChild:!0,preMessageHeadComponent:this.state.edit&&t.me.me&&(0,e.h)("div",{class:"message-head d-none d-md-block"},(0,e.h)("img",{class:"rounded-circle w-3 material-shadow avatar",style:t.util.backgroundHash(t.me.me.id),src:t.me.me.avatar?t.util.crop(t.me.me.avatar.id,100,100):t.util.defaultAvatar}))})}}exports.default=i;
},{"preact":"aSor","/core":"rqMW","./message.component.js":"u6BK"}],"gXdK":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var s=require("preact"),e=require("/core"),i=t(require("./message-child.component.js"));function t(s){return s&&s.__esModule?s:{default:s}}class l extends s.Component{constructor(s){super(s),this.onNewChild=this.onNewChild.bind(this),this.loadMessage=this.loadMessage.bind(this),this.displayPreviousChildren=this.displayPreviousChildren.bind(this),this.displayNextChildren=this.displayNextChildren.bind(this),this.state={firstDisplayedChild:0,lastDisplayedChild:0},window.addEventListener("newChild",this.onNewChild)}onNewChild(s){const i=s.detail;i.parent&&e.util.getId(i.parent)==this.props.id&&this.setState(s=>({lastDisplayedChild:s.lastDisplayedChild+1}))}loadMessage(){let s=0,i=0;if(this.props.childMessages.length){let t=e.router.action?this.props.childMessages.findIndex(s=>s&&s.id===e.router.action):-1;-1!=t?(s=Math.max(0,t-1),i=Math.min(this.props.childMessages.length,t+1)):(s=this.props.childMessages&&this.props.childMessages.length-5,i=this.props.childMessages&&this.props.childMessages.length)}this.setState({firstDisplayedChild:s,lastDisplayedChild:i})}displayPreviousChildren(){this.setState(s=>({firstDisplayedChild:Math.max(0,s.firstDisplayedChild-10)}))}displayNextChildren(){this.setState(s=>({lastDisplayedChild:Math.min(this.props.childMessages.length,s.lastDisplayedChild+10)}))}componentDidMount(){this.loadMessage()}render(){return this.state.lastDisplayedChild-this.state.firstDisplayedChild<1||!this.props.childMessages?null:(0,s.h)("div",{class:"children"},this.state.firstDisplayedChild>0&&(0,s.h)("div",{class:"d-flex"},(0,s.h)("span",{class:"more-coms unselectable",onClick:s=>this.displayPreviousChildren()},e.lang.t("previous_coms"))),this.props.childMessages.map((e,t,l)=>e.files.length||""!=e.data.text||e.children.length?t<this.state.firstDisplayedChild||t>this.state.lastDisplayedChild?null:(0,s.h)(i.default,{message:e,key:e.id,isPublic:this.props.isPublic}):null),this.state.lastDisplayedChild+1<this.props.childMessages.length&&(0,s.h)("div",{class:"d-flex"},(0,s.h)("span",{class:"more-coms unselectable",onClick:s=>this.displayNextChildren()},e.lang.t("next_coms"))))}}exports.default=l;
},{"preact":"aSor","/core":"rqMW","./message-child.component.js":"cVVC"}],"rXDu":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var r=require("preact"),a=require("/core"),e=require("/misc");class s extends r.Component{render(){return(0,r.h)("div",{class:"message-head d-flex"},(0,r.h)("div",null,(0,r.h)("img",{className:"rounded-circle material-shadow avatar"+(this.props.author.name?"":" removed-user"),style:a.util.backgroundHash(this.props.author.name?this.props.author.id:""),src:this.props.author&&this.props.author.avatar?a.util.crop(this.props.author.avatar.id,100,100):a.util.defaultAvatar,title:this.props.author.name||""})),!this.props.isChild&&(0,r.h)("div",{class:"infos"},(0,r.h)("span",{class:"capitalize author"},this.props.author.name||"--")))}}exports.default=s;
},{"preact":"aSor","/core":"rqMW","/misc":"V5Rv"}],"W867":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var s=require("preact"),e=require("/core"),i=require("/misc");class t extends s.Component{render(){return(0,s.h)("div",{class:"message-footer"},(0,s.h)("div",{class:"infos"},!this.props.isPublic&&this.props.author&&this.props.author.id==e.me.me.id&&(0,s.h)(s.Fragment,null,(0,s.h)("a",{class:"action seamless-link font-size-90 capitalize d-none d-sm-block",onClick:s=>this.props.editMessage(s)},e.lang.t("edit")),(0,s.h)("div",{class:"dot d-none d-sm-block"},"•")),!this.props.isPublic&&this.props.isChild&&(0,s.h)(s.Fragment,null,(0,s.h)("a",{class:"action seamless-link font-size-90 capitalize",href:e.router.toApp("/messages/"+this.props.message.id+(this.props.message.children.length?"":"?focus=reply")),onClick:s=>e.router.onClick(s)},this.props.message.children.length?this.props.message.children.some(s=>e.me.isNew(s.id))?(0,s.h)("b",null,e.lang.t("replies",{count:this.props.message.children.length})):e.lang.t("replies",{count:this.props.message.children.length}):e.lang.t("reply")),(0,s.h)("div",{class:"dot"},"•")),(0,s.h)("div",{class:"date font-size-90",title:e.util.humanFullDate(this.props.message.createdAt)},e.util.humanTime(this.props.message.createdAt)),(0,s.h)(s.Fragment,null,(0,s.h)("div",{class:"dot"},"•"),(0,s.h)("div",{class:"font-size-90"},this.props.author.name||"--"))),(0,s.h)("div",null,!this.props.isPublic&&(0,s.h)("div",{class:"options dropdown",onClick:s=>s.target.closest(".dropdown").classList.toggle("active")},(0,s.h)("div",{class:"none-if-follows-empty"},(0,s.h)(i.FaIcon,{family:"solid",icon:"ellipsis-h"})),(0,s.h)("div",{class:"dropdown-menu dropdown-options"},this.props.author&&this.props.author.id==e.me.me.id&&(0,s.h)("a",{class:"seamless-link capitalize",onClick:s=>this.props.deleteMessage(s)},e.lang.t("delete")),(0,s.h)("a",{class:"seamless-link capitalize",onClick:s=>this.props.openPublicLink(s)},e.lang.t("public_link")),e.me.me.groups.length>1&&(0,s.h)("a",{class:"seamless-link capitalize",onClick:s=>this.props.shareMessage(s)},e.lang.t("share_message")),!this.props.message.isInFront&&this.props.author&&this.props.author.id==e.me.me.id&&(0,s.h)("a",{class:"seamless-link capitalize",onClick:s=>this.props.publishInGroup(s)},e.lang.t("publish_in_group")),this.props.author&&this.props.author.id==e.me.me.id&&(0,s.h)("a",{class:"seamless-link capitalize d-block d-sm-none",onClick:s=>this.props.editMessage(s)},e.lang.t("edit"))))))}}exports.default=t;
},{"preact":"aSor","/core":"rqMW","/misc":"V5Rv"}],"gPUS":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("preact"),t=require("/core");class s extends e.Component{render(){let s="";const r=this.props.url.split("/"),l=t.router.getParam("t",this.props.url.split("?")[1]);switch(r[2]){case"www.twitch.tv":s=r.length>5&&"clip"==r[4]?"https://clips.twitch.tv/embed?clip="+r[5].replace(/\?.*$/,"")+"&autoplay=false":"https://player.twitch.tv/?video="+r[4].replace(/\?.*$/,"")+"&autoplay=false"+(l?"&t="+l:"");break;case"clips.twitch.tv":s="https://clips.twitch.tv/embed?clip="+r[3].replace(/\?.*$/,"")+"&autoplay=false"}return(0,e.h)("div",{class:"embed-responsive embed-responsive-16by9"},(0,e.h)("iframe",{allowfullscreen:!0,class:"embed-responsive-item",src:s}))}}exports.default=s;
},{"preact":"aSor","/core":"rqMW"}],"U94H":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("preact");class s extends e.Component{render(){const s=this.props.url+"/size=large/bgcol=f5f5f5/linkcol=0687f5/minimal=true/tracklist=false/";return this.state.revealed?(0,e.h)("div",{class:"bandcamp-embed embed-responsive embed-responsive-1by1"},(0,e.h)("iframe",{class:"embed-responsive-item",src:s})):(0,e.h)("div",{class:"embed-preview",onClick:()=>this.setState({revealed:!0})},(0,e.h)("div",{class:"bandcamp"}),(0,e.h)("img",{src:this.props.preview}))}}exports.default=s;
},{"preact":"aSor"}],"bleW":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("preact");class s extends e.Component{render(){return this.state.revealed?(0,e.h)("div",{class:"embed-responsive embed-responsive-16by9"},(0,e.h)("iframe",{allowfullscreen:!0,class:"embed-responsive-item",src:this.props.url})):(0,e.h)("div",{class:"embed-preview",onClick:()=>this.setState({revealed:!0})},(0,e.h)("div",{className:this.props.playBtnClass}),(0,e.h)("img",{src:this.props.preview}))}}exports.default=s;
},{"preact":"aSor"}],"M0D7":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _preact=require("preact"),_core=require("/core"),_twitchEmbedComponent=_interopRequireDefault(require("./embeds/twitch-embed.component.js")),_bandcampEmbedComponent=_interopRequireDefault(require("./embeds/bandcamp-embed.component.js")),_genericEmbedComponent=_interopRequireDefault(require("./embeds/generic-embed.component.js"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}class EmbedBlock extends _preact.Component{execute(e){if(e.innerHTML)eval(e.innerHTML);else{const t=e.getAttribute("src");if(t){const e=document.createElement("script");e.async=!0,e.src=t,document.head.appendChild(e)}}}componentDidMount(){this.embedContainer&&Array.from(this.embedContainer.getElementsByTagName("script")).forEach(e=>this.execute(e))}componentDidUpdate(){this.embedContainer&&Array.from(this.embedContainer.getElementsByTagName("script")).forEach(e=>this.execute(e))}getPreview(){if(this.props.data.providerUrl)switch(this.props.data.providerUrl.toLowerCase().replace(/\/$/,"").replace(/^https?:\/\/(www\.)?/,"")){case"lichess.org":return(0,_preact.h)(_genericEmbedComponent.default,{preview:_core.util.crop(this.props.preview.id,270,270),url:this.props.url.match("/study/")?this.props.url.replace("/study/","/study/embed/"):this.props.url.replace("lichess.org/","lichess.org/embed/"),playBtnClass:"lichess"});case"gamerdvr.com":if(this.props.data.url.match(/\/gamer\/\w+\/video\//))return(0,_preact.h)(_genericEmbedComponent.default,{preview:_core.util.crop(this.props.preview.id,1024,270),url:this.props.data.url+"/embed",playBtnClass:"gamerdvr"});break;case"youtube.com":if("video"==this.props.data.type&&this.props.data.code)return(0,_preact.h)(_genericEmbedComponent.default,{preview:_core.util.crop(this.props.preview.id,1024,270),url:this.props.data.code.match(/https:\/\/[^\"\s]+/)[0]+"&autoplay=1&controls=2&wmode=opaque",playBtnClass:"youtube"});break;case"soundcloud.com":if(this.props.data.code)return(0,_preact.h)(_genericEmbedComponent.default,{preview:_core.util.crop(this.props.preview.id,1024,270),url:this.props.data.code.match(/https:\/\/[^\"\s]+/)[0]+"&auto_play=true",playBtnClass:"soundcloud"});case"twitch.tv":return(0,_preact.h)(_twitchEmbedComponent.default,{preview:this.props.preview,url:this.props.data.url});case"bandcamp.com":if(this.props.data.code){let e=this.props.data.code.match(/https:\/\/.*album=\d+/);if(e||(e=this.props.data.code.match(/https:\/\/.*track=\d+/)),e)return(0,_preact.h)(_bandcampEmbedComponent.default,{preview:_core.util.crop(this.props.preview.id,1024,270),url:e[0]})}case"imgur.com":if("photo"==this.props.data.type)break;case"vimeo.com":case"dailymotion.com":case"facebook.com":case"kickstarter.com":if(this.props.data.code)return(0,_preact.h)("div",{class:"embed-container",ref:e=>this.embedContainer=e,dangerouslySetInnerHTML:{__html:this.props.data.code}})}if(this.props.data.providerName)switch(this.props.data.providerName.toLowerCase()){case"peertube":if(this.props.data.code)return(0,_preact.h)("div",{class:"embed-container",ref:e=>this.embedContainer=e,dangerouslySetInnerHTML:{__html:this.props.data.code}})}return/image/.test(this.props.data["content-type"])?(0,_preact.h)("div",{class:"container d-flex justify-content-center flex-wrap align-items-center"},(0,_preact.h)("img",{"data-nlg":!this.props.inWriter,href:_core.router.toApp(this.props.url),class:"img-fluid cursor-pointer","data-origin":this.props.url,"data-src":this.props.preview&&!/gif/.test(this.props.data["content-type"])?_core.util.thumbnail(this.props.preview.id,1366,768):this.props.url,src:this.props.preview&&!/gif/.test(this.props.data["content-type"])?_core.util.thumbnail(this.props.preview.id,1366,99999):this.props.url})):/video/.test(this.props.data["content-type"])?(0,_preact.h)("div",{class:"container d-flex justify-content-center flex-wrap align-items-center"},(0,_preact.h)("video",{class:"img-fluid",controls:!0,src:this.props.url})):/audio/.test(this.props.data["content-type"])?(0,_preact.h)("div",{class:"container d-flex justify-content-center flex-wrap align-items-center"},(0,_preact.h)("audio",{class:"w-100",controls:!0},(0,_preact.h)("source",{src:this.props.url}))):this.props.data.title&&(this.props.preview||this.props.data.description)?(0,_preact.h)("a",{class:"preview-card seamless-link d-inline-block",target:"_blank",href:_core.router.toApp(this.props.url)},(0,_preact.h)("div",{class:"card",style:"max-width: 480px"},this.props.preview&&(0,_preact.h)("img",{class:"card-img-top",src:_core.util.crop(this.props.preview.id,320,180)}),(0,_preact.h)("div",{class:"card-body p-1"},(0,_preact.h)("h5",null,this.props.data.title),this.props.data.description&&(0,_preact.h)("p",null,(0,_preact.h)("small",null,this.props.data.description.slice(0,500)))))):null}render(){if(!this.props.url||!this.props.data)return null;let e=this.getPreview();return e?(0,_preact.h)("p",{class:"text-center card-text"},e):null}}exports.default=EmbedBlock;
},{"preact":"aSor","/core":"rqMW","./embeds/twitch-embed.component.js":"gPUS","./embeds/bandcamp-embed.component.js":"U94H","./embeds/generic-embed.component.js":"bleW"}],"xBfm":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("preact"),t=require("/core"),s=a(require("./embed-block.component.js")),i=a(require("./file-grid.component.js")),r=require("/misc");function a(e){return e&&e.__esModule?e:{default:e}}class l extends e.Component{constructor(e){super(e),this.state={preview:null}}displayMessageText(){if(!this.props.message.data)return"";let e=this.props.message.data.text.replace(/</g,"&lt;").replace(/>/g,"&gt;").trim(),s=0,i=null;for(;i=t.util.getUrl(e.slice(s));){let t=i[0];t.length>=50&&(t=t.slice(0,25)+"..."+t.slice(-24));let r='<a href="'+i[0]+'" target="_blank">'+t+"</a>";e=e.slice(0,i.index+s)+r+e.slice(i.index+s+i[0].length),s+=i.index+r.length}return{__html:e=e.replace(/\n/g,"<br/>")}}componentDidMount(){this.componentWillUpdate()}componentWillUpdate(){if(!this.state.gotPreview&&this.props.message&&this.props.message.data){let e=t.util.getUrl(this.props.message.data.text);e?t.http.get("/api/links/by_url?url="+encodeURIComponent(e[0])).then(e=>{this.setState(t=>({preview:e,gotPreview:!0}))}):this.setState(e=>({gotPreview:!0}))}}render(){return(0,e.h)("div",{class:"message-body"},this.props.message.data&&this.props.message.data.title&&(0,e.h)("div",{class:"title"},(0,e.h)("span",null,this.props.message.data.title)),this.props.message.data&&this.props.message.data.text&&this.props.message.data.text.trim()&&(0,e.h)("p",{class:"card-text",dangerouslySetInnerHTML:this.displayMessageText()}),this.state.preview&&(0,e.h)(s.default,{key:this.state.preview.url,url:this.state.preview.url,preview:this.state.preview.preview,data:this.state.preview.data}),this.props.message.files&&(0,e.h)(i.default,{files:this.props.message.files}))}}exports.default=l;
},{"preact":"aSor","/core":"rqMW","./embed-block.component.js":"M0D7","./file-grid.component.js":"FklW","/misc":"V5Rv"}],"jeBy":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("preact"),t=require("/core"),s=require("/misc"),i=n(require("./embed-block.component.js")),l=n(require("./file-grid.component.js")),a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&(e[i]=s[i])}return e};function n(e){return e&&e.__esModule?e:{default:e}}class r extends e.Component{constructor(e){super(e),this.sendMessage=this.sendMessage.bind(this),this.genPreview=this.genPreview.bind(this),this.postMessage=this.postMessage.bind(this),this.putMessage=this.putMessage.bind(this),this.onKeyPress=this.onKeyPress.bind(this),this.toggleFile=this.toggleFile.bind(this),this.inputImages=this.inputImages.bind(this),this.inputVideo=this.inputVideo.bind(this),this.uploadFile=this.uploadFile.bind(this),this.uploadNextImage=this.uploadNextImage.bind(this),this.state={files:[],writerId:+Date.now()}}componentWillMount(){this.setState({files:this.props.files||[],link:null,preview:null})}componentDidMount(){document.getElementById("title")&&(document.getElementById("title").value=this.props.title||""),document.getElementById("text")&&(document.getElementById("text").value=this.props.text||"")}onKeyPress(e,t=!1){e.ctrlKey&&"Enter"==e.key?this.sendMessage():[" ","Enter","v"].includes(e.key)&&t&&this.genPreview(e.currentTarget)}genPreview(e){e.style.height="1px",e.style.height=25+e.scrollHeight+"px",setTimeout(()=>{let s=e.value.match(/(https?:\/\/[^\s]+)/gi);s&&s[0]!=this.state.link&&t.http.get("/api/links/by_url?url="+encodeURIComponent(s[0])).then(t=>{t&&e.value.indexOf(s[0])>=0&&this.setState({link:s[0],preview:t})})},0)}toggleFile(e){let t=this.state.files,s=t.find(t=>t.fileIndex==e);s.removed=!s.removed,this.setState({files:t})}sendMessage(){this.props.messageId?this.putMessage():this.postMessage()}putMessage(){let e={files:this.state.files.filter(e=>!e.removed).map(e=>e.id).filter(e=>!!e),data:{text:document.getElementById("text").value}};document.getElementById("title")&&(e.data.title=document.getElementById("title").value||""),t.http.put("/api/messages/"+this.props.messageId,e).then(e=>{this.setState({sending:!1}),e?window.dispatchEvent(new CustomEvent("editMessage",{detail:e})):t.alert.add(t.lang.t("error_new_message"),"alert-danger")}),this.setState({sending:!0})}postMessage(){let e={createdAt:Math.floor(Date.now()/1e3),author:t.me.me.id,group:t.util.getId(this.props.group),children:[],files:this.state.files.filter(e=>!e.removed).map(e=>e.id).filter(e=>!!e),data:{text:(document.getElementById("text").value||"").substring(0,5e4)},lastActivityDate:Math.floor(Date.now()/1e3)};this.props.parent&&(e.parent=t.util.getId(this.props.parent)),document.getElementById("title")&&(e.data.title=document.getElementById("title").value||""),e.files.length||e.data.text||e.data.title?(t.http.post("/api/messages",e).then(s=>{if(!s)return this.setState({sending:!1}),void t.alert.add(t.lang.t("error_new_message"),"alert-danger");this.props.isChild?(this.setState({sending:!1}),window.dispatchEvent(new CustomEvent("newChild",{detail:s}))):setTimeout(i=>{window.dispatchEvent(new CustomEvent("newParent",{detail:s})),t.router.navigate(t.router.backUrl||e.group.slice(4))},500),this.setState({files:[],link:null,preview:null,writerId:+Date.now()}),document.getElementById("text")&&(document.getElementById("text").value="")}),this.setState({sending:!0})):t.alert.add(t.lang.t("empty_message"),"alert-danger")}inputImages(e){const t=document.createElement("input");document.body.appendChild(t),t.style.display="none",t.type="file",t.multiple="multiple",t.accept="image/*",t.addEventListener("change",e=>{let t=Array.from(e.target.files),s=this.state.files;this.setState({files:[...s,...Array.apply(null,Array(t.length)).map(e=>new Object({fileIndex:1e3}))]}),this.uploadNextImage(t,t[Symbol.iterator](),s.length)}),t.click()}inputVideo(e){const t=document.createElement("input");document.body.appendChild(t),t.style.display="none",t.type="file",t.accept="video/*",t.addEventListener("change",e=>{let t=this.state.files,s=Date.now();this.setState({files:[...t,{fileIndex:s,type:"video",progress:0}]}),this.uploadFile(e.target.files[0],t.length,s)}),t.click()}uploadNextImage(e,s,i){let l=null;try{if(!s)return;if(!(l=s.next())||!l.value)return;l.value.size}catch(a){return void t.alert.add(t.lang.t("multiple_photos_upload"),"alert-danger")}require("_bundle_loader")(require.resolve("/lazy/image-service.js")).then(t=>{t.default.handleImage(l.value,t=>this.uploadFile(t,i+e.indexOf(l.value),null,()=>this.uploadNextImage(e,s,i)))})}uploadFile(e,s,i,l=null){const a=new FormData;a.append("file",e),a.append("fileIndex",s);let n=i?t=>{if(Array.isArray(this.state.files)){let l=this.state.files;(e=l.find(e=>e.fileIndex==i))&&(e.progress=Math.floor(t.loaded/t.total*100),l.splice(s,1,e),this.setState({files:l}))}}:null,r=this.state.writerId;t.http.sendFile(a,e=>{if(r!=this.state.writerId)return;let i=this.state.files;e?i.splice(s,1,e):t.alert.add(t.lang.t("error_upload"),"alert-danger"),this.setState({files:i}),l&&l()},n,e=>{console.warn(e),t.alert.add(t.lang.t("error_upload"),"alert-danger");let i=this.state.files;i.splice(s,1,{fileIndex:s,error:e}),this.setState({files:i})})}render(){return this.state.sending?(0,e.h)("div",{class:"message-placeholder"},(0,e.h)("div",{class:"spinner orange-spinner"},(0,e.h)("div",null),(0,e.h)("div",null),(0,e.h)("div",null),(0,e.h)("div",null),(0,e.h)("div",null))):(0,e.h)("div",{class:"writer"},!this.props.isChild&&(0,e.h)("input",{type:"text",id:"title",onKeyPress:e=>this.onKeyPress(e),placeholder:t.lang.t("title_placeholder")}),(0,e.h)("textarea",{onKeyPress:e=>this.onKeyPress(e,!0),id:"text",rows:"5",autocomplete:"off",autofocus:this.props.focus,placeholder:t.lang.t("text_placeholder"),maxlength:"50000"}),this.state.preview&&(0,e.h)(i.default,a({inWriter:!0},this.state.preview)),!!this.state.files.length&&(0,e.h)(l.default,{key:this.state.files.reduce((e,t)=>e+t.id+t.fileIndex+t.error,""),files:this.state.files,toggleFile:this.toggleFile,inWriter:!0}),(0,e.h)("div",{class:"options"},(0,e.h)("button",{class:"option",onClick:e=>this.inputImages(e),title:t.lang.t("upload_image")},(0,e.h)(s.FaIcon,{family:"regular",icon:"images"})),(0,e.h)("button",{class:"option",onClick:e=>this.inputVideo(e),title:t.lang.t("upload_video")},(0,e.h)(s.FaIcon,{family:"solid",icon:"film"})),(0,e.h)("div",{class:"actions"},this.props.cancel&&(0,e.h)("button",{class:"cancel",onClick:e=>this.props.cancel(e)},t.lang.t("cancel")),(0,e.h)("button",{disabled:!this.props.group,type:"submit",class:"submit",onClick:e=>this.sendMessage(e)},t.lang.t("submit")))))}}exports.default=r;
},{"preact":"aSor","/core":"rqMW","/misc":"V5Rv","./embed-block.component.js":"M0D7","./file-grid.component.js":"FklW","_bundle_loader":"TUK3","/lazy/image-service.js":[["image-service.f760b5f5.js","Z93z"],"image-service.f760b5f5.js.map","Z93z"]}],"u6BK":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var s=require("preact"),e=require("/core"),t=require("/misc"),i=o(require("./message-children.component.js")),a=o(require("./message-head.component.js")),r=o(require("./message-footer.component.js")),h=o(require("./message-body.component.js")),p=o(require("./writer.component.js"));function o(s){return s&&s.__esModule?s:{default:s}}class d extends s.Component{constructor(s){super(s),this.getComponentClass=this.getComponentClass.bind(this),this.editMessage=this.editMessage.bind(this),this.deleteMessage=this.deleteMessage.bind(this),this.shareMessage=this.shareMessage.bind(this),this.publishInGroup=this.publishInGroup.bind(this),this.cancelEdit=this.cancelEdit.bind(this),this.onEditMessage=this.onEditMessage.bind(this),this.openPublicLink=this.openPublicLink.bind(this),window.addEventListener("editMessage",this.onEditMessage)}async openPublicLink(s){s.preventDefault();let t=window.open("about:blank","_blank");const i=await e.http.get("/api/messages/"+this.props.message.id+"/get-public-link");t.location=window.origin+"/public/"+i.token}onEditMessage(s){if(s.detail.id==this.props.message.id){this.props.key=+Date.now();let e=this.props.message;e.data=s.detail.data,e.files=s.detail.files,this.setState({message:e,data:e.data,gotPreview:!1}),setTimeout(s=>this.setState({edit:!1}))}}getComponentClass(){let s="message";return this.props.isChild&&(s+=" child"),this.props.message.id==e.router.action&&(s+=" highlight"),s}deleteMessage(s){s.preventDefault(),confirm(e.lang.t("ask_delete_message"))&&(e.http.delete("/api/messages/"+this.props.message.id),this.props.isChild?this.setState({isRemoved:!0}):e.router.navigate("/groups/"+this.props.message.group.id,{data:{resetGroupDisplay:!0}}))}shareMessage(s){s.preventDefault(),e.router.navigate("/share?message="+this.props.message.id)}editMessage(s){s.preventDefault(),this.setState({edit:!0})}publishInGroup(){e.http.put("/api/messages/"+this.props.message.id,{lastActivityDate:Math.floor(Date.now()/1e3),isInFront:!0}).then(s=>{s?e.router.navigate("/groups/"+this.props.message.group.id):alert.add(e.lang.t("error"),"alert-danger")})}cancelEdit(s){s.preventDefault(),this.setState({edit:!1})}displayWriter(e,t){return(0,s.h)(p.default,{cancel:this.state.edit?this.cancelEdit:null,files:this.state.edit?this.props.message.files:[],focus:t||!!this.state.edit,group:this.props.message.group,messageId:this.state.edit?this.props.message.id:null,parent:this.state.edit?this.props.message.parent:this.props.message.id,text:this.state.edit?this.props.message.data.text:"",title:this.state.edit?this.props.message.data.title:"",isChild:e})}render(){return this.state.isRemoved?null:(0,s.h)(s.Fragment,null,(0,s.h)("div",{id:this.props.message.id,className:this.getComponentClass()},this.state.edit&&this.displayWriter(this.props.isChild),!this.state.edit&&(0,s.h)(s.Fragment,null,this.props.preMessageHeadComponent,(0,s.h)(a.default,{author:this.props.message.author,message:this.props.message,isPublic:this.props.isPublic,isChild:this.props.isChild}),(0,s.h)("div",{class:"main"},(0,s.h)(h.default,{message:this.props.message,isPublic:this.props.isPublic,isChild:this.props.isChild}),(0,s.h)(r.default,{author:this.props.message.author,message:this.props.message,editMessage:this.editMessage,deleteMessage:this.deleteMessage,shareMessage:this.shareMessage,publishInGroup:this.publishInGroup,openPublicLink:this.openPublicLink,isPublic:this.props.isPublic,isChild:this.props.isChild})))),this.props.postMessageComponent,!this.props.isChild&&(0,s.h)(i.default,{childMessages:this.props.message.children,isPublic:this.props.isPublic,key:this.props.message.id,id:this.props.message.id}),!this.state.edit&&!this.props.isPublic&&!this.props.isChild&&(0,s.h)("div",{class:"message child mt-2"},e.me.me&&(0,s.h)("div",{class:"message-head d-none d-md-block"},(0,s.h)("img",{class:"rounded-circle w-3 material-shadow avatar",style:e.util.backgroundHash(e.me.me.id),src:e.me.me.avatar?e.util.crop(e.me.me.avatar.id,100,100):e.util.defaultAvatar})),this.displayWriter(!0,this.props.focus)))}}exports.default=d;
},{"preact":"aSor","/core":"rqMW","/misc":"V5Rv","./message-children.component.js":"gXdK","./message-head.component.js":"rXDu","./message-footer.component.js":"W867","./message-body.component.js":"xBfm","./writer.component.js":"jeBy"}],"kSsz":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("preact"),s=require("/core"),t=i(require("./message.component.js"));function i(e){return e&&e.__esModule?e:{default:e}}class o extends e.Component{constructor(e){super(e),this.onNewChild=this.onNewChild.bind(this),window.addEventListener("newChild",this.onNewChild),this.state={message:this.props.message}}componentDidMount(){s.me.removeMatchingNotifications(this.props.message.id),setTimeout(()=>window.scrollTo(0,0))}onNewChild(e){const t=e.detail;let i=this.state.message;t.parent&&s.util.getId(t.parent)==i.id&&(t.author=s.me.me,i.children=[...i.children,t],this.setState(e=>({lastDisplayedChild:e.lastDisplayedChild+1,message:i})))}render(){if(this.state.message&&!this.state.isRemoved)return(0,e.h)(t.default,{message:this.state.message,focus:this.props.focus,isPublic:this.props.isPublic,isChild:!1})}}exports.default=o;
},{"preact":"aSor","/core":"rqMW","./message.component.js":"u6BK"}],"Ttzu":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("preact"),t=require("/core"),s=require("/misc");class a extends e.Component{constructor(e){super(e),this.state={message:e.message}}componentDidMount(){this.state.message&&this.state.message.author&&t.http.get("/api/users/"+this.state.message.author).then(e=>e&&this.setState({author:e}))}getAvatar(s){return(0,e.h)("img",{title:s?s.name:"--",className:"avatar material-shadow"+(s?"":" removed-user"),style:t.util.backgroundHash(s?s.id:""),src:s&&s.avatar?t.util.crop(s.avatar.id,100,100):t.util.defaultAvatar,onError:e=>e.currentTarget.src=t.util.defaultAvatar})}render(){return this.state.message?(0,e.h)("a",{class:"d-inline-block seamless-link message-preview unselectable",href:t.router.toApp("/messages/"+this.state.message.id),onClick:e=>t.router.onClick(e),title:this.state.message.data.title},(0,e.h)("div",{tabindex:this.props.tabindex,class:"card material-shadow"},this.getAvatar(this.state.author),this.state.message.preview?(0,e.h)("div",{class:"card-miniature",style:"background-image: url('"+t.util.crop(this.state.message.preview,320,180)+"')"}):(0,e.h)("div",{class:"text-preview"},this.state.message.data.text),(0,e.h)("div",{class:"card-body border-top d-flex justify-content-between"},(0,e.h)("span",{class:"left-buffer"}),(0,e.h)("span",{class:"title",title:this.state.message.data.title||t.util.humanFullDate(this.state.message.lastActivityDate)},this.state.message.data.title||t.util.humanTime(this.state.message.lastActivityDate)),(0,e.h)("span",{class:"children"},!!this.state.message.children&&(0,e.h)("span",null,this.state.message.children+" ",(0,e.h)(s.FaIcon,{family:t.me.isNew(this.state.message.id)?"solid":"regular",icon:"comment"})))))):null}}exports.default=a;
},{"preact":"aSor","/core":"rqMW","/misc":"V5Rv"}],"tKGR":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("preact"),t=require("/core"),s=require("/misc");class i extends e.Component{constructor(e){super(e),this.state={message:e.message,title:e.message.data.title||"",text:e.message.data.text||"",preview:e.message.preview||null},this.getMiniature=this.getMiniature.bind(this),this.getLink=this.getLink.bind(this),this.displayMessageTitle=this.displayMessageTitle.bind(this),this.displayMessageText=this.displayMessageText.bind(this)}componentDidMount(){this.props.message.author&&t.http.get("/api/users/"+this.props.message.author).then(e=>e&&this.setState({author:e}))}displayAuthorName(){if(!this.state.author)return{__html:"--"};let e=this.state.author.name,s=e.split(" ");for(let i=0;i<s.length;i++)if(!s[i].match(t.util.urlRegExp)){let e=this.props.search.split(" ");for(let t=0;t<e.length;t++)s[i]=s[i].replace(new RegExp(e[t],"gi"),"<b>$&</b>")}return{__html:e=s.join(" ")}}displayMessageTitle(){if(!this.props.message.data||!this.props.message.data.title)return{__html:t.util.humanTime(this.props.message.lastActivityDate)};let e=this.props.message.data.title.replace(/</g,"&lt;").replace(/>/g,"&gt;").trim(),s=e.split(" ");for(let i=0;i<s.length;i++)if(!s[i].match(t.util.urlRegExp)){let e=this.props.search.split(" ");for(let t=0;t<e.length;t++)s[i]=s[i].replace(new RegExp(e[t],"gi"),"<b>$&</b>")}return{__html:e=s.join(" ")}}displayMessageText(){if(!this.props.message.data||!this.props.message.data.text)return"";let e=this.props.message.data.text.replace(/</g,"&lt;").replace(/>/g,"&gt;").trim(),s=e.split("\n");for(let l=0;l<s.length;l++){let e=s[l].split(" ");for(let s=0;s<e.length;s++)if(!e[s].match(t.util.urlRegExp)){let t=this.props.search.split(" ");for(let a=0;a<t.length;a++)t[a]&&(e[s]=e[s].replace(new RegExp(t[a],"gi"),"<b>$&</b>"));let i=this.props.hashtags.split(" ");for(let a=0;a<i.length;a++)i[a]&&(e[s]=e[s].replace(new RegExp("#"+i[a],"gi"),"<b>$&</b>"))}s[l]=e.join(" ")}e=s.join("\n");let i=0,a=null;for(;a=t.util.getUrl(e.slice(i));){let t=a[0];t.length>=50&&(t=t.slice(0,25)+"..."+t.slice(-24));let s=this.props.search.split(" ");for(let e=0;e<s.length;e++)t=t.replace(new RegExp(s[e],"gi"),"<b>$&</b>");let l='<a href="'+a[0]+'" target="_blank">'+t+"</a>";e=e.slice(0,a.index+i)+l+e.slice(a.index+i+a[0].length),i+=a.index+l.length}return{__html:e=e.replace(/\n/g,"<br/>")}}getMiniature(){if(this.state.preview)return(0,e.h)("div",{class:"card-miniature",style:"background-image: url('"+t.util.crop(this.state.preview,100,100)+"')"});let s=t.util.defaultAvatar;return this.state.author&&this.state.author.avatar&&this.state.author.avatar.id&&(s=t.util.crop(this.state.author.avatar.id,100,100)),(0,e.h)("div",{class:"card-miniature",style:"background-image: url('"+s+"')"})}getLink(){return this.state.message.parent&&0==this.state.message.children?"/messages/"+this.state.message.parent+"/"+this.state.message.id:"/messages/"+this.state.message.id}render(){return(0,e.h)("a",{class:"d-inline-block seamless-link message-preview unselectable",href:t.router.toApp(this.getLink()),onClick:e=>t.router.onClick(e),title:this.state.title},(0,e.h)("div",{tabindex:this.props.tabindex,class:"card material-shadow"},(0,e.h)("div",{class:"card-body border-top"},this.getMiniature(),(0,e.h)("div",{class:"infos"},(0,e.h)("div",{class:"title",dangerouslySetInnerHTML:this.displayAuthorName()}),(0,e.h)("div",{class:"dot"},"•"),(0,e.h)("div",{class:"title",title:this.state.title||t.util.humanFullDate(this.state.message.lastActivityDate),dangerouslySetInnerHTML:this.displayMessageTitle()})),(0,e.h)("div",{class:"text"},this.state.text.trim()&&(0,e.h)("p",{class:"card-text",dangerouslySetInnerHTML:this.displayMessageText()})),(0,e.h)("div",{class:"children"},!!this.state.message.children&&(0,e.h)("span",null,this.state.message.children+" ",(0,e.h)(s.FaIcon,{family:t.me.isNew(this.state.message.id)?"solid":"regular",icon:"comment"}))))))}}exports.default=i;
},{"preact":"aSor","/core":"rqMW","/misc":"V5Rv"}],"EPQO":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.EmbedBlock=exports.MessageSearchResult=exports.MessagePreview=exports.MessageHead=exports.MessageChildren=exports.MessageChild=exports.MessageParent=exports.MessageFooter=exports.MessageBody=exports.FileGrid=void 0;var e=u(require("./file-grid.component.js")),s=u(require("./message-parent.component.js")),o=u(require("./message-child.component.js")),t=u(require("./message-body.component.js")),r=u(require("./message-children.component.js")),a=u(require("./message-head.component.js")),n=u(require("./message-footer.component.js")),p=u(require("./message-preview.component.js")),d=u(require("./message-search-result.component.js")),c=u(require("./embed-block.component.js"));function u(e){return e&&e.__esModule?e:{default:e}}const i=e.default;exports.FileGrid=i;const l=t.default;exports.MessageBody=l;const g=n.default;exports.MessageFooter=g;const m=s.default;exports.MessageParent=m;const x=o.default;exports.MessageChild=x;const M=r.default;exports.MessageChildren=M;const f=a.default;exports.MessageHead=f;const j=p.default;exports.MessagePreview=j;const h=d.default;exports.MessageSearchResult=h;const q=c.default;exports.EmbedBlock=q;
},{"./file-grid.component.js":"FklW","./message-parent.component.js":"kSsz","./message-child.component.js":"cVVC","./message-body.component.js":"xBfm","./message-children.component.js":"gXdK","./message-head.component.js":"rXDu","./message-footer.component.js":"W867","./message-preview.component.js":"Ttzu","./message-search-result.component.js":"tKGR","./embed-block.component.js":"M0D7"}],"I6Rh":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("preact"),s=require("/core"),t=require("/message");class a extends e.Component{constructor(e){super(e);let t=s.util.getId(s.router.id),a=1+Math.floor(window.screen.width*window.screen.height/68800);this.state={groupId:t,loaded:a,messages:[],totalMessages:0,search:s.router.getParam("search").replace(/\+/g," "),hashtags:s.router.getParam("hashtags").replace(/\+/g," ")},this.loadMessages=this.loadMessages.bind(this),window.addEventListener("routerStateChange",e=>this.loadMessages())}getGroupName(){if(s.me.me.groups&&"group"==s.router.entity.entityType){let e=s.me.me.groups.find(e=>e.id==s.util.getId(s.router.entity));return e?e.name:""}return""}componentDidMount(){this.loadMessages()}loadMessages(){let e=s.router.getParam("search").replace(/\+/g," "),t=s.router.getParam("hashtags").split("+").join(" ");s.http.post("/api/messages/search",{group:this.state.groupId,search:e,hashtags:t}).then(s=>{s&&Array.isArray(s.messages)&&this.setState({search:e,messages:s.messages,totalMessages:s.totalItems,loaded:s.messages.length})})}render(){return Array.isArray(this.state.messages)&&(0,e.h)("div",null,(0,e.h)("a",{href:s.router.toApp("/groups/"+s.util.getGroupId()),onClick:e=>s.router.onClick(e)},(0,e.h)("div",{class:"group-name no-decoration"},s.util.getGroupName())),(0,e.h)("article",{id:"group",class:"justify-content-center d-flex"},(0,e.h)("div",{class:"search-results-container container-fluid d-flex justify-content-center flex-wrap"},this.state.messages.slice(0,this.state.loaded).map((s,a)=>(0,e.h)(t.MessageSearchResult,{tabindex:a+1,key:s.id,message:s,groupId:this.state.groupId,search:this.state.search,hashtags:this.state.hashtags})))))}}exports.default=a;
},{"preact":"aSor","/core":"rqMW","/message":"EPQO"}],"WcYj":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("preact"),r=require("/core"),s=require("/misc");class t extends e.Component{constructor(e){super(e),addEventListener("meStateChange",e=>this.setState({}))}render(){return(0,e.h)("div",{class:"navbar-block"},r.me.me.groups&&(0,e.h)("div",{class:"nav-link dropdown groups unselectable",tabindex:"-1",onClick:e=>e.currentTarget.classList.toggle("active")},(0,e.h)("div",{class:"unselectable pr-1"},r.lang.t("groups")," ",(0,e.h)(s.FaIcon,{family:"solid",icon:"caret-down"})),(0,e.h)("div",{class:"dropdown-menu dropdown-left"},r.me.me.groups.map(s=>(0,e.h)("a",{class:"d-block seamless-link unselectable",href:r.router.toApp("/groups/"+s.id),onClick:e=>r.router.onClick(e)},s.name)),(0,e.h)("a",{class:"seamless-link unselectable",href:r.router.toApp("/create-group"),onClick:e=>r.router.onClick(e)},"+ "+r.lang.t("create_a_group")))))}}exports.default=t;
},{"preact":"aSor","/core":"rqMW","/misc":"V5Rv"}],"lNP6":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("preact"),t=require("/core");class r extends e.Component{constructor(){super(),this.postNewGroup=this.postNewGroup.bind(this)}postNewGroup(e){e.preventDefault();const r=document.querySelector("#create_group_form input[name='name']").value;let o={};if(!r)return!1;o.name=r,o.createdAt=Math.floor(Date.now()/1e3),t.http.post("/api/groups",o).then(e=>{t.http.post("/api/groups/invitation/"+e.secretKey,{}).then(e=>{window.location="/groups/"+e.id})})}render(){return(0,e.h)("div",{class:"container mt-2"},(0,e.h)("div",{class:"group-settings"},(0,e.h)("div",{class:"card"},(0,e.h)("div",{class:"card-body"},(0,e.h)("div",{class:"container-fluid p-1"},(0,e.h)("div",{class:"row"},(0,e.h)("div",{class:"col-12 col-md-10"},(0,e.h)("form",{id:"create_group_form",class:"mb-1"},(0,e.h)("div",{class:"form-group"},(0,e.h)("label",{for:"name"},t.lang.t("name"),": "),(0,e.h)("input",{type:"text",name:"name",minlength:"1",maxlength:"128",placeholder:t.lang.t("name_input"),class:"form-control",required:!0})),(0,e.h)("button",{onClick:e=>this.postNewGroup(e),class:"btn btn-primary"},t.lang.t("create_the_group"))))))))))}}exports.default=r;
},{"preact":"aSor","/core":"rqMW"}],"Hinj":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("preact"),t=require("/core"),s=require("/message"),a=require("/pages");class o extends e.Component{constructor(e){super(e);let s=t.util.getId(t.router.id),a=1+Math.floor(window.screen.width*window.screen.height/68800);this.state={groupId:s,loaded:a,messages:[],scrollTop:0,totalMessages:0,pageYOffset:0,page:0},this.scroll_cooldown=Date.now(),this.onScroll=this.onScroll.bind(this),this.loadMessages=this.loadMessages.bind(this),this.onNewParent=this.onNewParent.bind(this),window.addEventListener("newParent",this.onNewParent),window.addEventListener("resetCache",this.resetGroupDisplay)}onNewParent(e){this.loadMessages(0)}componentDidMount(){this.loadMessages(0),window.addEventListener("scroll",this.onScroll)}componentWillUnmount(){window.removeEventListener("scroll",this.onScroll)}loadMessages(e){t.http.get("/api/groups/"+this.state.groupId+"/page/"+e).then(t=>{if(t&&Array.isArray(t.messages)){let s=Math.max(this.state.loaded,30*e),a=this.state.messages;t.messages.map(e=>!a.find(t=>t.id==e.id)&&a.push(e)),this.setState({messages:a,totalMessages:t.totalItems,page:e,loaded:s}),30*(e+1)<s&&setTimeout(()=>this.loadMessages(e+1))}})}onScroll(){"none"!=window.getComputedStyle(document.getElementById("group").parentNode).display&&this.scroll_cooldown+100<Date.now()&&(this.scroll_cooldown=Date.now(),this.setState({pageYOffset:window.pageYOffset}),Array.isArray(this.state.messages)&&document.body.scrollHeight-window.screen.height-500<window.pageYOffset&&this.state.loaded<this.state.totalMessages&&(this.setState(e=>({loaded:e.loaded+10})),this.state.loaded+30>this.state.messages.length&&(this.loadMessages(this.state.page+1),this.setState(e=>({page:e.page+1})))))}render(){return Array.isArray(this.state.messages)&&(0,e.h)("div",null,(0,e.h)(a.GroupTitle,{key:t.util.getGroupId(),id:t.util.getGroupId(),name:t.util.getGroupName()}),(0,e.h)("article",{id:"group",class:"justify-content-center d-flex"},(0,e.h)("div",{class:"message-container container-fluid d-flex justify-content-center flex-wrap"},this.state.messages.slice(0,this.state.loaded).map((a,o)=>(0,e.h)(s.MessagePreview,{tabindex:o+1,key:a.id,message:a,groupId:t.util.getId(t.router.id)})))))}}exports.default=o;
},{"preact":"aSor","/core":"rqMW","/message":"EPQO","/pages":"U7IS"}],"FJIr":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=require("preact"),e=require("/core"),a=require("/misc");class s extends t.Component{constructor(t){super(t),this.updateSettings=this.updateSettings.bind(this),this.leaveGroup=this.leaveGroup.bind(this),this.leave=this.leave.bind(this),this.resetSecretKey=this.resetSecretKey.bind(this),this.state=Object.assign({hydratedUsers:[]},t)}resetSecretKey(t){t.preventDefault(),e.http.post("/api/groups/"+this.state.id+"/reset-invite-key",{}).then(t=>{e.alert.add(e.lang.t("group_updated")),this.setState({secretKey:t.inviteKey})})}updateSettings(t){t.preventDefault();const a=document.querySelector("#settings_form input[name='name']").value;let s={};a&&(s.name=a),e.http.put("/api/groups/"+this.state.id,s).then(t=>{e.alert.add(e.lang.t("group_updated")),this.setState(e=>Object.assign(e,t))})}leaveGroup(t){if(t.preventDefault(),e.me.me.data.default_group==this.state.id){let t={};t.data={default_group:e.me.me.groups[0].id},e.http.put("/api/users/"+e.me.me.id,t).then(t=>{e.me.update(),this.leave()})}else this.leave()}leave(){e.http.post("/api/groups/"+this.state.id+"/leave",{}).then(t=>{t&&t.entityType?(e.me.update(),e.alert.add(e.lang.t("group_left")),e.router.navigate("/")):e.alert.add(e.lang.t("error"),"alert-danger")})}render(){return(0,t.h)("div",null,(0,t.h)("div",{class:"group-settings mb-3"},(0,t.h)("div",{class:"card"},(0,t.h)("div",{class:"card-body"},(0,t.h)("div",{class:"container-fluid p-1"},(0,t.h)("div",{class:"row"},(0,t.h)("div",{class:"col-12 col-md-10"},(0,t.h)("form",{id:"settings_form",class:"mb-1 border-bottom pb-1"},(0,t.h)("div",{class:"form-group"},(0,t.h)("label",{for:"name"},e.lang.t("name"),": "),(0,t.h)("input",{type:"text",name:"name",minlength:"1",maxlength:"128",placeholder:e.lang.t("name_input"),value:this.state.name,class:"form-control",required:!0})),(0,t.h)("button",{onClick:this.updateSettings,class:"btn btn-outline-secondary"},e.lang.t("save_changes"))),(0,t.h)("form",{class:"mb-1 border-bottom pb-1"},(0,t.h)("div",{class:"form-group"},(0,t.h)("label",{for:"inviteKey"},e.lang.t("invitation_link"),":"," "),(0,t.h)("input",{type:"text",name:"inviteKey",value:location.protocol+"//"+location.host+"/invitation/"+this.state.secretKey,class:"form-control font-size-80",readonly:"readonly"})),(0,t.h)("button",{class:"btn btn-outline-secondary",onClick:this.resetSecretKey},e.lang.t("reset_invitation_link"))),(0,t.h)("form",null,(0,t.h)("button",{onClick:t=>this.leaveGroup(t),class:"btn btn-outline-danger"},e.lang.t("quit_group"))))))))),(0,t.h)("div",{class:"user-list mb-3"},(0,t.h)("h3",null,e.lang.t("users")),this.props.users.map(a=>a&&(0,t.h)("div",{class:"user-card"},(0,t.h)("img",{class:"avatar material-shadow",style:e.util.backgroundHash(a.id),src:a.avatar?e.util.crop(a.avatar.id,200,200):e.util.defaultAvatar,onError:t=>t.currentTarget.src=e.util.defaultAvatar}),(0,t.h)("span",null,a.name)))))}}exports.default=s;
},{"preact":"aSor","/core":"rqMW","/misc":"V5Rv"}],"e3YL":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=require("preact"),e=require("/core"),a=require("/misc");class l extends t.Component{constructor(t){super(t),this.destroyAccount=this.destroyAccount.bind(this),this.inputAvatar=this.inputAvatar.bind(this),this.updateSettings=this.updateSettings.bind(this),this.state=Object.assign({},t)}inputAvatar(t){const a=document.createElement("input");a.type="file",a.accept="image/*",a.addEventListener("change",t=>{let a=new Image;a.onload=(()=>{let t=Math.min(a.naturalWidth,1024),l=Math.min(a.naturalHeight,1024),s=Math.min(t/a.naturalWidth,l/a.naturalHeight),n=Math.floor(a.naturalWidth*s),o=Math.floor(a.naturalHeight*s);require("_bundle_loader")(require.resolve("/lazy/image-service.js")).then(t=>{t.default.resize(a,n,o,t=>{const a=new FormData;a.append("file",t),e.http.post("/api/files",a,!1).then(t=>{e.http.put("/api/users/"+this.state.id,{avatar:t.id}).then(a=>{this.setState({avatar:t}),e.alert.add(e.lang.t("settings_updated"))})})})})}),a.src=URL.createObjectURL(t.target.files[0])}),a.click()}destroyAccount(t){t.preventDefault(),confirm(e.lang.t("are_you_sure"))&&e.http.delete("/api/users/"+this.state.id).then(t=>{e.router.navigate("/logout")})}updateSettings(t){t.preventDefault();const a=document.querySelector("#settings_form input[name='name']").value,l=document.querySelector("#settings_form input[name='email']").value,s=document.querySelector("#settings_form input[name='password']").value,n=document.querySelector("#settings_form select[name='notification_emails']").value,o=document.querySelector("#settings_form select[name='default_group']").value,r=document.querySelector("#settings_form select[name='lang']").value;let i={};a&&(i.name=a),l&&(i.login=l),s&&(i.password=s),i.data={notification_emails:n,default_group:o,lang:r},e.http.put("/api/users/"+this.state.id,i).then(t=>{t.error?e.alert.add(t.error,"alert-danger"):(e.cache.removeMatching(this.state.id),this.setState(e=>Object.assign(e,t)),location.href=e.router.toApp(location.pathname+"?alert=settings_updated"))})}render(){return(0,t.h)("div",{class:"user-settings"},(0,t.h)("div",{class:"card"},(0,t.h)("div",{class:"identite card-body"},(0,t.h)("div",{class:"container-fluid p-1"},(0,t.h)("div",{class:"row"},(0,t.h)("div",{class:"col-12 col-md-2"},(0,t.h)("img",{class:"img-fluid rounded-circle material-shadow avatar",src:this.state.avatar?e.util.crop(this.state.avatar.id,100,100):e.util.defaultAvatar,onError:t=>t.currentTarget.src=e.util.defaultAvatar,onClick:t=>this.inputAvatar(t)})),(0,t.h)("div",{class:"col-12 col-md-10"},(0,t.h)("form",{id:"settings_form",class:"mb-3"},(0,t.h)("div",{class:"form-group"},(0,t.h)("label",{for:"name"},e.lang.t("name"),": "),(0,t.h)("input",{type:"text",name:"name",minlength:"1",maxlength:"128",placeholder:e.lang.t("name_input"),value:this.state.name,class:"form-control"})),(0,t.h)("div",{class:"form-group"},(0,t.h)("label",{for:"email"},e.lang.t("email"),": "),(0,t.h)("input",{type:"email",name:"email",placeholder:e.lang.t("email_input"),value:this.state.login,class:"form-control"})),(0,t.h)("div",{class:"form-group"},(0,t.h)("label",{for:"password"},e.lang.t("password"),": "),(0,t.h)("input",{type:"password",name:"password",autocomplete:"off",minlength:"8",maxlength:"128",placeholder:e.lang.t("password_input"),class:"form-control"})),(0,t.h)("div",{class:"form-group"},(0,t.h)("label",{for:"notification_emails"},e.lang.t("notification_emails"),":"),(0,t.h)("select",{name:"notification_emails",class:"form-control",value:this.state.data.notification_emails},(0,t.h)("option",{value:"none"},e.lang.t("none")),(0,t.h)("option",{value:"hourly"},e.lang.t("hourly")),(0,t.h)("option",{value:"daily"},e.lang.t("daily")),(0,t.h)("option",{value:"weekly"},e.lang.t("weekly")),(0,t.h)("option",{value:"monthly"},e.lang.t("monthly")))),(0,t.h)("div",{class:"form-group"},(0,t.h)("label",{for:"default_group"},e.lang.t("default_group"),":"),(0,t.h)("select",{name:"default_group",class:"form-control",value:this.state.data.default_group},e.me.me.groups.map(e=>(0,t.h)("option",{value:e.id},e.name)))),(0,t.h)("div",{class:"form-group"},(0,t.h)("label",{class:"capitalize",for:"lang"},e.lang.t("lang"),":"),(0,t.h)("select",{name:"lang",class:"form-control",value:e.lang.getCurrentLang()},Object.keys(e.lang.possibleLang).map(a=>(0,t.h)("option",{value:a},e.lang.possibleLang[a])))),(0,t.h)("button",{onClick:t=>this.updateSettings(t),class:"btn btn-primary"},e.lang.t("save_changes"))),(0,t.h)("form",{id:"destroy_form"},(0,t.h)("label",{class:"d-block",for:"destroy_account"},e.lang.t("destroy_account_explain")),(0,t.h)("button",{onClick:t=>this.destroyAccount(t),name:"destroy_account",class:"btn btn-danger"},e.lang.t("destroy_account")))))))),this.state.alert&&(0,t.h)("div",{class:"global-alert alert alert-success"},this.state.alert))}}exports.default=l;
},{"preact":"aSor","/core":"rqMW","/misc":"V5Rv","_bundle_loader":"TUK3","/lazy/image-service.js":[["image-service.f760b5f5.js","Z93z"],"image-service.f760b5f5.js.map","Z93z"]}],"TbUJ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=require("preact"),e=require("/core"),s=require("/misc"),i=r(require("./user-settings.component.js")),n=r(require("./group-settings.component.js"));function r(t){return t&&t.__esModule?t:{default:t}}class a extends t.Component{constructor(t){super(t),this.state={},t.entityUrl&&e.http.get(t.entityUrl).then(t=>this.setState({entity:t}))}render(){if(this.state.entity&&e.me.me)return(0,t.h)("div",{class:"settings"},(0,t.h)("ul",{class:"nav nav-tabs"},(0,t.h)("li",{class:"nav-item"},(0,t.h)("a",{class:"nav-link"+("user"==this.state.entity.entityType?" active":""),href:e.router.toApp("/users/"+e.me.me.id+"/settings"),onClick:t=>e.router.onClick(t)},e.lang.t("account"))),e.me.me.groups.length>0&&(0,t.h)("li",{class:"nav-item dropdown group-list",tabindex:"-1",onClick:t=>t.currentTarget.classList.toggle("active")},(0,t.h)("div",{class:"nav-link"+("group"==this.state.entity.entityType?" active":"")},e.lang.t("groups")),(0,t.h)("div",{class:"dropdown-menu"},e.me.me.groups.map(s=>(0,t.h)("a",{class:"seamless-link",href:e.router.toApp("/groups/"+s.id+"/settings"),onClick:t=>e.router.onClick(t)},s.name))))),"user"===this.state.entity.entityType&&(0,t.h)(i.default,this.state.entity),"group"===this.state.entity.entityType&&(0,t.h)(n.default,this.state.entity))}}exports.default=a;
},{"preact":"aSor","/core":"rqMW","/misc":"V5Rv","./user-settings.component.js":"e3YL","./group-settings.component.js":"FJIr"}],"kp7P":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.UserSettings=exports.Settings=exports.GroupSettings=void 0;var e=r(require("./group-settings.component.js")),t=r(require("./settings.component.js")),s=r(require("./user-settings.component.js"));function r(e){return e&&e.__esModule?e:{default:e}}const o=e.default;exports.GroupSettings=o;const n=t.default;exports.Settings=n;const u=s.default;exports.UserSettings=u;
},{"./group-settings.component.js":"FJIr","./settings.component.js":"TbUJ","./user-settings.component.js":"e3YL"}],"s19K":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("preact"),r=require("/core"),t=require("/message"),s=require("/pages"),i=require("/settings"),o=require("/navbar"),u=require("/misc"),a=n(require("/message/writer.component.js"));function n(e){return e&&e.__esModule?e:{default:e}}class l extends e.Component{constructor(e){super(e)}render(){if("settings"==this.props.action)return(0,e.h)("article",{class:"mt-2 justify-content-center d-flex"},(0,e.h)("div",{class:"container pb-3"},(0,e.h)(i.Settings,{key:this.props.entityUrl,entityUrl:this.props.entityUrl})));switch(this.props.route){case"create-group":return(0,e.h)(s.CreateGroup,null);case"share":return(0,e.h)(s.Share,null);case"messages":return(0,e.h)("article",{class:"mb-3 justify-content-center d-flex"},(0,e.h)("div",{class:"container pb-3"},(0,e.h)(s.GroupTitle,{key:r.util.getGroupId(),id:r.util.getGroupId(),name:r.util.getGroupName()}),(0,e.h)(t.MessageParent,{focus:!!r.router.getParam("focus",r.router.search),key:r.router.entity.id,message:r.router.entity})));case"groups":return"write"==this.props.action?(0,e.h)("article",{class:"mb-3"},(0,e.h)("div",{class:"container pb-3"},(0,e.h)(s.GroupTitle,{key:r.util.getGroupId(),id:r.util.getGroupId(),name:r.util.getGroupName()}),(0,e.h)(a.default,{focus:!0,group:this.props.id}))):r.router.getParam("search")||r.router.getParam("hashtags")?(0,e.h)("div",null,(0,e.h)(o.GroupSearch,{key:this.props.id})):(0,e.h)("div",null,(0,e.h)(s.GroupBoard,{key:this.props.id}),(0,e.h)("a",{class:"write-button material-shadow seamless-link",href:r.router.toApp("/groups/"+this.props.id+"/write"),onClick:e=>r.router.onClick(e)},(0,e.h)(u.FaIcon,{family:"solid",icon:"pencil-alt"})))}}}exports.default=l;
},{"preact":"aSor","/core":"rqMW","/message":"EPQO","/pages":"U7IS","/settings":"kp7P","/navbar":"slC9","/misc":"V5Rv","/message/writer.component.js":"jeBy"}],"AhCJ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=require("preact"),e=require("/core");class r extends t.Component{constructor(t){super(t),this.getMiniature=this.getMiniature.bind(this),this.setMiniatureOnError=this.setMiniatureOnError.bind(this),this.getAction=this.getAction.bind(this),this.getTarget=this.getTarget.bind(this),this.state={target:this.getTarget(),action:this.getAction()}}getMiniature(){let r=e.util.defaultAvatar;return this.props.fromUser&&this.props.fromUser.avatar&&"global_notification"!=this.props.type&&(r=e.util.crop(this.props.fromUser.avatar.id,80,80)),(0,t.h)("img",{style:e.util.backgroundHash(this.props.fromUser?this.props.fromUser.id:""),src:r,onError:t=>this.setMiniatureOnError(t)})}setMiniatureOnError(t){t.currentTarget.src=e.util.defaultAvatar}getAction(){switch(this.props.type){case"new_message":return e.lang.t("has_posted_in");case"new_comment":return e.lang.t("has_commented_on");case"user_joined_group":return e.lang.t("has_joined");case"user_left_group":return e.lang.t("has_left");case"group_name_change":return e.lang.t("changed_group_name");default:return""}}getObject(){switch(this.props.type){case"new_message":return(0,t.h)("a",{href:e.router.toApp("/groups/"+this.props.fromGroup.id),onClick:t=>e.router.onClick(t)},this.props.fromGroup.name);case"new_comment":return(0,t.h)("span",null,e.lang.t("the_message_from")+" ",(0,t.h)("strong",null,this.props.fromMessage&&this.props.fromMessage.author?this.props.fromMessage.author.name:"")," "+e.lang.t("in")+" ",(0,t.h)("a",{href:e.router.toApp("/groups/"+this.props.fromGroup.id),onClick:t=>e.router.onClick(t)},this.props.fromGroup.name));case"user_joined_group":case"user_left_group":return(0,t.h)("a",{href:e.router.toApp("/groups/"+this.props.fromGroup.id),onClick:t=>e.router.onClick(t)},this.props.fromGroup.name);case"group_name_change":return(0,t.h)("span",null,(0,t.h)("strong",null,this.props.data.previousGroupName)," "+e.lang.t("to")+" ",(0,t.h)("strong",null,this.props.data.newGroupName));case"global_notification":return this.props.data.text;default:return""}}getTarget(){switch(this.props.type){case"user_joined_group":case"user_left_group":case"group_name_change":return"/groups/"+this.props.fromGroup.id;case"new_message":return"/messages/"+this.props.target;case"new_comment":return"/messages/"+this.props.fromMessage.id+"/"+this.props.target;case"global_notification":return this.props.target;default:return""}}render(){return(0,t.h)("a",{class:"notification seamless-link unselectable",href:e.router.toApp(this.state.target),onClick:t=>{t.preventDefault(),e.me.removeMatchingNotifications(this.props.id).then(r=>e.router.onClick(t,!1,this.state.target))}},(0,t.h)("div",{class:"miniature unselectable"},this.getMiniature()),(0,t.h)("div",{class:"infos"},(0,t.h)("div",{class:"description"},"global_notification"!=this.props.type&&(0,t.h)(t.Fragment,null,(0,t.h)("strong",null,this.props.fromUser.name||"--"),(0,t.h)("span",null," "+this.state.action+" ")),this.getObject()),(0,t.h)("div",{class:"date",title:e.util.humanFullDate(this.props.createdAt)},e.util.humanTime(this.props.createdAt))))}}exports.default=r;
},{"preact":"aSor","/core":"rqMW"}],"YeY7":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("preact"),r=require("/core"),t=require("/misc");class s extends e.Component{constructor(e){super(e),this.search=this.search.bind(this)}search(e){e.preventDefault();let t=document.getElementById("search").value.normalize("NFD").replace(/[\u0300-\u036f]/g,"").split(" "),s="messages"==r.router.route?r.router.entity.group.id:r.router.entity.id;r.router.navigate("/groups/"+s+"?search="+t.map(e=>encodeURIComponent(e)).join("+"))}render(){return(0,e.h)("form",{class:"navbar-block search-block"},(0,e.h)("div",{class:"input-group"},(0,e.h)("input",{class:"form-control",type:"text",id:"search",placeholder:r.lang.t("search_in_group"),value:decodeURIComponent(r.router.getParam("search").replace(/\+/g," "))}),(0,e.h)("div",{class:"input-group-append"},(0,e.h)("button",{onClick:e=>this.search(e),class:"btn btn-secondary",type:"submit"},(0,e.h)(t.FaIcon,{family:"solid",icon:"search"})))))}}exports.default=s;
},{"preact":"aSor","/core":"rqMW","/misc":"V5Rv"}],"WLLU":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("preact"),t=require("/core"),r=require("/misc"),s=a(require("/message/writer.component.js"));function a(e){return e&&e.__esModule?e:{default:e}}class u extends e.Component{constructor(){super();let e=new URL(window.location);this.state={loaded:!1,group:null,currentUrl:e,title:e.searchParams.get("title")||"",text:e.searchParams.get("text")||"",url:e.searchParams.get("url")||"",files:null},this.groupSelect=this.groupSelect.bind(this)}componentDidMount(){t.me.get().then(e=>{e.data.default_group?(this.setState({group:e.data.default_group}),t.router.backUrl="/groups/"+e.data.default_group):1==e.groups.length&&(this.setState({group:e.groups[0].id}),t.router.backUrl="/groups/"+e.groups[0]),this.state.currentUrl.searchParams.get("message")?t.http.get("/api/messages/"+this.state.currentUrl.searchParams.get("message")).then(e=>{this.setState({loaded:!0,title:e&&e.data.title||"",text:e&&e.data.text||"",url:"",files:e&&e.files||null})}):this.setState({loaded:!0})})}groupSelect(e){this.setState({group:e.target.value}),t.router.backUrl="/groups/"+e.target.value}render(){if(this.state.loaded)return(0,e.h)("article",{class:"mt-2"},(0,e.h)("div",{class:"container"},t.me.me&&t.me.me.groups.length>1&&(0,e.h)("div",{class:"mb-1"},(0,e.h)("label",{for:"group_share_choice"},t.lang.t("group_share_choice")),(0,e.h)("select",{value:this.state.group,class:"form-control",name:"group_share_choice",onChange:e=>this.groupSelect(e),required:!0},t.me.me.groups.map(t=>(0,e.h)("option",{value:t.id},t.name)))),(0,e.h)(s.default,{focus:!0,group:this.state.group,title:this.state.title,text:this.state.text||this.state.url?this.state.text+"\n"+this.state.url:"",files:this.state.files})))}}exports.default=u;
},{"preact":"aSor","/core":"rqMW","/misc":"V5Rv","/message/writer.component.js":"jeBy"}],"qHFq":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("preact"),r=require("/core");class o extends e.Component{constructor(e){super(e)}render(){return(0,e.h)("a",{href:r.router.toApp("/groups/"+this.props.id),onClick:e=>r.router.onClick(e),class:"no-decoration"},(0,e.h)("div",{class:"group-name"},this.props.name))}}exports.default=o;
},{"preact":"aSor","/core":"rqMW"}],"U7IS":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.GroupTitle=exports.Share=exports.Search=exports.Notification=exports.MainContent=exports.GroupBoard=exports.CreateGroup=void 0;var e=u(require("./create-group.component.js")),o=u(require("./group-board.component.js")),t=u(require("./main-content.component.js")),r=u(require("./notification.component.js")),n=u(require("./search.component.js")),s=u(require("./share.component.js")),p=u(require("./group-title.component.js"));function u(e){return e&&e.__esModule?e:{default:e}}const a=e.default;exports.CreateGroup=a;const i=o.default;exports.GroupBoard=i;const c=t.default;exports.MainContent=c;const d=r.default;exports.Notification=d;const x=n.default;exports.Search=x;const l=s.default;exports.Share=l;const f=p.default;exports.GroupTitle=f;
},{"./create-group.component.js":"lNP6","./group-board.component.js":"Hinj","./main-content.component.js":"s19K","./notification.component.js":"AhCJ","./search.component.js":"YeY7","./share.component.js":"WLLU","./group-title.component.js":"qHFq"}],"jTq1":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("preact"),r=require("/core"),t=require("/misc"),a=require("/pages"),o=require("/navbar");class s extends e.Component{constructor(e){super(e),this.clickBackButton=this.clickBackButton.bind(this),addEventListener("meStateChange",e=>this.setState({}))}clickBackButton(e){if(e.preventDefault(),r.router.backUrlPrompt&&!confirm(r.router.backUrlPrompt))return!1;r.router.onClick(e)}render(){return(0,e.h)("div",{class:"main-nav nav align-items-center z-index-100"},(0,e.h)("div",{class:"navbar-block"},(["share"].includes(r.router.route)||["settings"].includes(r.router.action)||!r.router.backUrl)&&(0,e.h)("div",{class:"menu dropdown cursor-pointer",tabindex:"-1",onClick:e=>e.currentTarget.classList.toggle("active")},(0,e.h)("div",{class:"rounded-circle avatar unselectable"},(0,e.h)("img",{class:"rounded-circle",style:r.util.backgroundHash(r.me.me.id),src:r.me.me.avatar?r.util.crop(r.me.me.avatar.id,80,80):r.util.defaultAvatar,onError:e=>e.currentTarget.src=r.util.defaultAvatar})),(0,e.h)("div",{class:"dropdown-menu dropdown-right"},(0,e.h)("a",{class:"d-block seamless-link",href:r.router.toApp("/users/"+r.me.me.id+"/settings"),onClick:e=>r.router.onClick(e)},r.lang.t("settings")),(0,e.h)("a",{class:"d-block seamless-link",href:r.router.toApp("/logout"),onClick:e=>r.router.onClick(e)},r.lang.t("logout")))),["groups","messages"].includes(r.router.route)&&r.router.backUrl&&(0,e.h)("a",{class:"seamless-link back",href:r.router.toApp(r.router.backUrl),onClick:e=>this.clickBackButton(e)},(0,e.h)(t.FaIcon,{family:"solid",icon:"arrow-left"})),(0,e.h)(o.NotificationsDropdownNavbar,null)),(0,e.h)(a.Search,null),(0,e.h)(o.GroupsDropdownNavbar,null))}}exports.default=s;
},{"preact":"aSor","/core":"rqMW","/misc":"V5Rv","/pages":"U7IS","/navbar":"slC9"}],"P2ph":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=require("preact"),e=require("/core"),i=require("/misc"),n=require("/pages"),a=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t};class o extends t.Component{constructor(t){super(t),addEventListener("meStateChange",t=>this.setState({})),this.clearAllNotifications=this.clearAllNotifications.bind(this)}clearAllNotifications(){e.me.me.notifications.length&&Promise.all(e.me.me.notifications.map(t=>e.http.delete("/api/notifications/"+t.id))).then(e.me.update())}render(){return(0,t.h)("div",{className:"menu dropdown"+(e.me.me.notifications.length?" cursor-pointer":""),tabindex:"-1",onClick:t=>e.me.me.notifications.length&&t.currentTarget.classList.toggle("active")},(0,t.h)("div",{class:"unselectable notification-button"},(0,t.h)(i.FaIcon,{family:e.me.me.notifications.length?"solid":"regular",icon:"bell"}),!!e.me.me.notifications.length&&(0,t.h)("span",{class:"notification-count"},e.me.me.notifications.length)),(0,t.h)("div",{class:"dropdown-menu dropdown-right notifications-menu"},(0,t.h)("div",{class:"notification-header"},(0,t.h)("strong",{class:"capitalize"},e.lang.t("notifications")),(0,t.h)("div",{class:"action capitalize",onClick:t=>this.clearAllNotifications()},e.lang.t("mark_all_as_read"))),e.me.me.notifications?e.me.me.notifications.sort((t,e)=>e.createdAt-t.createdAt).map(e=>(0,t.h)(n.Notification,a({key:e.id},e))):null))}}exports.default=o;
},{"preact":"aSor","/core":"rqMW","/misc":"V5Rv","/pages":"U7IS"}],"slC9":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.NotificationsDropdownNavbar=exports.Navbar=exports.GroupsDropdownNavbar=exports.GroupSearch=void 0;var o=a(require("./group-search.component.js")),r=a(require("./groups-dropdown-navbar.component.js")),e=a(require("./navbar.component.js")),t=a(require("./notifications-dropdown-navbar.component.js"));function a(o){return o&&o.__esModule?o:{default:o}}const n=o.default;exports.GroupSearch=n;const s=r.default;exports.GroupsDropdownNavbar=s;const p=e.default;exports.Navbar=p;const u=t.default;exports.NotificationsDropdownNavbar=u;
},{"./group-search.component.js":"I6Rh","./groups-dropdown-navbar.component.js":"WcYj","./navbar.component.js":"jTq1","./notifications-dropdown-navbar.component.js":"P2ph"}],"TXJy":[function(require,module,exports) {
module.exports="zusam_logo.12e2d2b3.svg";
},{}],"GoyJ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("preact"),s=require("/core"),t=a(require("/assets/zusam_logo.svg"));function a(e){return e&&e.__esModule?e:{default:e}}class o extends e.Component{constructor(){super(),this.state={showAlert:!1,error:""},this.sendLoginForm=this.sendLoginForm.bind(this),this.sendPasswordReset=this.sendPasswordReset.bind(this),this.showPasswordReset=this.showPasswordReset.bind(this),s.storage.get("apiKey").then(e=>e&&s.router.navigate("/"))}sendPasswordReset(e){e.preventDefault();let t=document.getElementById("login").value||"";t.toLowerCase(),this.setState({sending:!0}),s.http.post("/api/password-reset-mail",{mail:t}).then(e=>{this.setState({sending:!1}),e&&!e.message?s.alert.add(s.lang.t("password_reset_mail_sent")):s.alert.add(s.lang.t(e.message),"alert-danger")})}sendLoginForm(e){e.preventDefault(),this.setState({showAlert:!1,sending:!0});let t=document.getElementById("login").value||"";t.toLowerCase();const a=document.getElementById("password").value;s.http.post("/api/login",{login:t,password:a}).then(e=>{this.setState({sending:!1}),e&&e.api_key?s.storage.set("apiKey",e.api_key).then(()=>{s.me.update().then(()=>{setTimeout(()=>s.router.navigate("/"),100)})}):e&&e.message?s.alert.add(s.lang.t(e.message),"alert-danger"):s.alert.add(s.lang.t("error"),"alert-danger")})}showPasswordReset(){this.setState({showResetPassword:!0})}render(){return(0,e.h)("div",{class:"login"},(0,e.h)("div",{class:"login-form"},(0,e.h)("img",{src:t.default}),!this.state.showResetPassword&&(0,e.h)("form",null,(0,e.h)("div",{class:"form-group"},(0,e.h)("input",{type:"email",class:"form-control",required:!0,id:"login",placeholder:s.lang.t("login_placeholder")})),(0,e.h)("div",{class:"form-group"},(0,e.h)("input",{type:"password",class:"form-control",required:!0,id:"password",placeholder:s.lang.t("password_placeholder")})),(0,e.h)("div",{class:"forgot-password"},(0,e.h)("span",{onClick:e=>this.showPasswordReset(e)},s.lang.t("forgot_password"))),(0,e.h)("button",{type:"submit",class:"btn btn-light",onClick:e=>this.sendLoginForm(e),disabled:this.state.sending},s.lang.t("connect"))),!!this.state.showResetPassword&&(0,e.h)("form",null,(0,e.h)("div",{class:"form-group"},(0,e.h)("input",{type:"email",class:"form-control",required:!0,id:"login",placeholder:s.lang.t("login_placeholder")})),(0,e.h)("button",{type:"submit",class:"btn btn-light",onClick:e=>this.sendPasswordReset(e),disabled:this.state.sending},s.lang.t("submit")))))}}exports.default=o;
},{"preact":"aSor","/core":"rqMW","/assets/zusam_logo.svg":"TXJy"}],"gfHB":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("preact"),s=require("/core");class t extends e.Component{constructor(){super(),this.sendNewPassword=this.sendNewPassword.bind(this)}sendNewPassword(e){e.preventDefault(),s.storage.set("apiKey","");const t=document.getElementById("password").value||"",r=document.getElementById("password_confirmation").value||"",a=s.router.getParam("mail"),o=s.router.getParam("key");if(a&&t){if(t!=r)return void s.alert.add(s.lang.t("passwords_dont_match"));s.http.post("/api/new-password",{mail:a,key:o,password:t}).then(e=>{e.api_key?(s.storage.set("apiKey",e.api_key),setTimeout(()=>s.router.navigate("/"),100)):s.alert.add(s.lang.t(e.message))}).catch(e=>console.warn(e))}}render(){return(0,e.h)("div",{class:"login"},(0,e.h)("div",{class:"login-form"},(0,e.h)("h2",{class:"title"},s.lang.t("reset_password_title")),(0,e.h)("form",null,(0,e.h)("div",{class:"form-group"},(0,e.h)("input",{type:"password",class:"form-control",required:!0,id:"password",placeholder:s.lang.t("new_password_placeholder")})),(0,e.h)("div",{class:"form-group"},(0,e.h)("input",{type:"password",class:"form-control",required:!0,id:"password_confirmation",placeholder:s.lang.t("confirm_password_placeholder")})),(0,e.h)("button",{type:"submit",class:"btn btn-light",onClick:e=>this.sendNewPassword(e)},s.lang.t("submit")))))}}exports.default=t;
},{"preact":"aSor","/core":"rqMW"}],"HnNM":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("preact"),t=require("/core"),s=r(require("/assets/zusam_logo.svg"));function r(e){return e&&e.__esModule?e:{default:e}}class o extends e.Component{constructor(){super(),this.state={showAlert:!1,error:"",inviteKey:t.router.getParam("inviteKey")},this.sendSignupForm=this.sendSignupForm.bind(this)}sendSignupForm(e){e.preventDefault(),this.setState({showAlert:!1});let s=document.getElementById("login").value||"";s.toLowerCase();const r=document.getElementById("password").value;t.storage.set("apiKey",""),t.http.post("/api/signup",{login:s,password:r,invite_key:this.state.inviteKey}).then(e=>{e&&!e.message?(t.storage.set("apiKey",e.api_key),setTimeout(()=>t.router.navigate("/"),100)):t.alert.add(t.lang.t(e.message))})}render(){return(0,e.h)("div",{class:"signup"},(0,e.h)("div",{class:"signup-form"},(0,e.h)("img",{src:s.default}),(0,e.h)("div",{class:"welcome lead"},t.lang.t("invitation_welcome")),(0,e.h)("form",null,(0,e.h)("div",{class:"form-group"},(0,e.h)("input",{type:"email",class:"form-control",required:!0,id:"login",placeholder:t.lang.t("login_placeholder")})),(0,e.h)("div",{class:"form-group"},(0,e.h)("input",{type:"password",class:"form-control",required:!0,id:"password",placeholder:t.lang.t("password_placeholder")})),(0,e.h)("button",{type:"submit",class:"btn btn-light",onClick:e=>this.sendSignupForm(e)},t.lang.t("signup")))))}}exports.default=o;
},{"preact":"aSor","/core":"rqMW","/assets/zusam_logo.svg":"TXJy"}],"IWRl":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("preact"),t=require("/core");class s extends e.Component{constructor(){super(),t.http.get("/api"+window.location.pathname).then(e=>{this.setState({message:t.lang.t("notification_emails_stopped")})}).catch(e=>{console.warn(e),this.setState({message:t.lang.t("error")})})}render(){return(0,e.h)("div",null,this.state.message||"")}}exports.default=s;
},{"preact":"aSor","/core":"rqMW"}],"Zdby":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("preact"),t=require("/core"),s=require("/message");class r extends e.Component{constructor(e){super(e),this.state={}}componentDidMount(){this.props.token&&t.http.get("/api/public/"+this.props.token).then(e=>this.setState({message:e}))}render(){if(this.state.message)return(0,e.h)("article",{class:"justify-content-center d-flex mt-2"},(0,e.h)("div",{class:"container"},(0,e.h)(s.MessageParent,{isPublic:!0,key:this.state.message.id,message:this.state.message})))}}exports.default=r;
},{"preact":"aSor","/core":"rqMW","/message":"EPQO"}],"Dm2o":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Public=exports.StopNotificationEmails=exports.Signup=exports.ResetPassword=exports.Login=void 0;var e=i(require("./login.component.js")),o=i(require("./reset-password.component.js")),t=i(require("./signup.component.js")),s=i(require("./stop-notification-emails.component.js")),r=i(require("./public.component.js"));function i(e){return e&&e.__esModule?e:{default:e}}const n=e.default;exports.Login=n;const p=o.default;exports.ResetPassword=p;const u=t.default;exports.Signup=u;const c=s.default;exports.StopNotificationEmails=c;const a=r.default;exports.Public=a;
},{"./login.component.js":"GoyJ","./reset-password.component.js":"gfHB","./signup.component.js":"HnNM","./stop-notification-emails.component.js":"IWRl","./public.component.js":"Zdby"}],"A2T1":[function(require,module,exports) {
"use strict";var e=require("preact"),t=require("preact/compat"),r=require("/core"),o=require("/navbar"),i=require("/pages"),n=require("/outside");class s extends e.Component{constructor(){super(),this.onRouterStateChange=this.onRouterStateChange.bind(this),console.log("localStorage usage: "+r.storage.usage()),r.cache.purgeOldCache(),window.addEventListener("routerStateChange",this.onRouterStateChange),window.addEventListener("meStateChange",e=>this.setState({me:r.me.me})),window.addEventListener("fetchedNewDict",e=>this.setState({})),window.addEventListener("popstate",r.router.sync),window.addEventListener("click",e=>{e.target.closest(".dropdown")||document.querySelectorAll(".dropdown").forEach(e=>e.classList.remove("active"))}),r.lang.fetchDict(),r.storage.get("apiKey").then(e=>{r.router.isOutside()||e?r.router.sync():r.router.navigate("/login")}),this.state={action:r.router.action,route:r.router.route,id:r.router.id,entityUrl:r.router.entityUrl}}onRouterStateChange(){this.setState({action:r.router.action,route:r.router.route,id:r.router.id,entityUrl:r.router.entityUrl}),setTimeout(()=>window.scrollTo(0,0)),r.storage.get("apiKey").then(e=>{e&&"login"!=r.router.route?r.me.get().then(e=>{e||r.router.isOutside()?this.setState({action:r.router.action,route:r.router.route,id:r.router.id,me:e,entityUrl:r.router.entityUrl}):r.storage.set("apiKey","").then(e=>r.router.navigate("/login"))}):r.router.isOutside()||r.router.navigate("/login")}),r.alert.add(r.lang.t(r.router.getParam("alert",r.router.search)))}render(){switch(this.state.route){case"signup":return(0,e.h)(n.Signup,null);case"stop-notification-emails":return(0,e.h)(n.StopNotificationEmails,null);case"public":return(0,e.h)(n.Public,{token:this.state.id,key:this.state.id});case"password-reset":return(0,e.h)(n.ResetPassword,null);case"login":return(0,e.h)(n.Login,null)}if(this.state.me&&this.state.me.groups)return(0,e.h)("main",null,(0,e.h)(o.Navbar,null),(0,e.h)("div",{class:"content"},(0,e.h)(i.MainContent,this.state)))}}(0,e.render)((0,e.h)(s,null),document.body),"serviceWorker"in navigator&&window.addEventListener("load",function(){location.search.includes("service-workers=unregister")&&(navigator.serviceWorker.getRegistrations().then(function(e){for(let t of e)t.unregister()}),console.log("Service workers unregistered")),navigator.serviceWorker.register("service-workers.js").then(function(e){console.log("ServiceWorker registration successful with scope: ",e.scope)},function(e){console.warn("ServiceWorker registration failed: ",e)})});
},{"preact":"aSor","preact/compat":"AQ6k","/core":"rqMW","/navbar":"slC9","/pages":"U7IS","/outside":"Dm2o","/data/app/src/service-workers.js":[["service-workers.js","qGzB"],"service-workers.js.map","qGzB"]}],"Yi9z":[function(require,module,exports) {
module.exports=function(n){return new Promise(function(e,o){var r=document.createElement("script");r.async=!0,r.type="text/javascript",r.charset="utf-8",r.src=n,r.onerror=function(n){r.onerror=r.onload=null,o(n)},r.onload=function(){r.onerror=r.onload=null,e()},document.getElementsByTagName("head")[0].appendChild(r)})};
},{}],0:[function(require,module,exports) {
var b=require("TUK3");b.register("js",require("Yi9z"));
},{}]},{},[0,"A2T1"], null)
//# sourceMappingURL=app.d91bcf23.js.map